<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.pulmuone.v1.comm.mapper.policy.regularshipping.PolicyRegularShippingMapper">

	<!--───────────────────────────────────────────────────────────────────────
	 * description 		: 정기배송설정
	 * @
	 * @ 수정일			수정자          수정내용
	 * @ ──────────────────────────────────────────────────────────────────────
	 * @ 2020.09.02		박승현          최초생성
	 * @
	────────────────────────────────────────────────────────────────────────-->
	<resultMap type="kr.co.pulmuone.v1.policy.regularshipping.dto.PolicyRegularShippingDto" id="getPolicyRegularShippingInfoMap">
		<result column="REGULAR_SHIPPING_BASIC_DISCOUNT_RATE"  property="regularShippingBasicDiscountRate"  />
		<result column="REGULAR_SHIPPING_ADDITIONAL_DISCOUNT_APPLICATION_TIMES"  property="regularShippingAdditionalDiscountApplicationTimes" />
		<result column="REGULAR_SHIPPING_ADDITIONAL_DISCOUNT_RATE"  property="regularShippingAdditionalDiscountRate"  />
		<result column="REGULAR_SHIPPING_MAX_CUSTOMER_CYCLE"  property="regularShippingMaxCustomerCycle" />
		<result column="REGULAR_SHIPPING_PAYMENT_FAIL_TERMINATE"  property="regularShippingPaymentFailTerminate" />
	</resultMap>
	<select id="getPolicyRegularShipping" resultMap="getPolicyRegularShippingInfoMap">
		/*	PolicyRegularShipping.getPolicyRegularShipping	*/
		SELECT
		  GROUP_CONCAT(if(PS_KEY = 'REGULAR_SHIPPING_BASIC_DISCOUNT_RATE', PS_VAL, NULL)) AS 'REGULAR_SHIPPING_BASIC_DISCOUNT_RATE',
		  GROUP_CONCAT(if(PS_KEY = 'REGULAR_SHIPPING_ADDITIONAL_DISCOUNT_APPLICATION_TIMES', PS_VAL, NULL)) AS 'REGULAR_SHIPPING_ADDITIONAL_DISCOUNT_APPLICATION_TIMES',
		  GROUP_CONCAT(if(PS_KEY = 'REGULAR_SHIPPING_ADDITIONAL_DISCOUNT_RATE', PS_VAL, NULL)) AS 'REGULAR_SHIPPING_ADDITIONAL_DISCOUNT_RATE' ,
		  GROUP_CONCAT(if(PS_KEY = 'REGULAR_SHIPPING_MAX_CUSTOMER_CYCLE', PS_VAL, NULL)) AS 'REGULAR_SHIPPING_MAX_CUSTOMER_CYCLE' ,
		  GROUP_CONCAT(if(PS_KEY = 'REGULAR_SHIPPING_PAYMENT_FAIL_TERMINATE', PS_VAL, NULL)) AS 'REGULAR_SHIPPING_PAYMENT_FAIL_TERMINATE'
		FROM PS_CONFIG
		WHERE 1=1
		AND PS_KEY in
		('REGULAR_SHIPPING_BASIC_DISCOUNT_RATE'
		,'REGULAR_SHIPPING_ADDITIONAL_DISCOUNT_APPLICATION_TIMES'
		,'REGULAR_SHIPPING_ADDITIONAL_DISCOUNT_RATE'
		,'REGULAR_SHIPPING_MAX_CUSTOMER_CYCLE'
		,'REGULAR_SHIPPING_PAYMENT_FAIL_TERMINATE'
		)
		LIMIT 1
	</select>


	<!--───────────────────────────────────────────────────────────────────────
	 * description 		: 정기배송 기본설정 저장
	 * @
	 * @ 수정일			수정자          수정내용
	 * @ ──────────────────────────────────────────────────────────────────────
	 * @ 2020.09.04		박승현          최초생성
	 * @
	────────────────────────────────────────────────────────────────────────-->
	<update id="putPolicyRegularShipping">
		/*	PolicyRegularShipping.putPolicyRegularShipping	*/
		UPDATE PS_CONFIG
		SET
			PS_VAL =
				CASE
				WHEN PS_KEY = 'REGULAR_SHIPPING_BASIC_DISCOUNT_RATE' THEN #{regularShippingBasicDiscountRate}
				WHEN PS_KEY = 'REGULAR_SHIPPING_ADDITIONAL_DISCOUNT_APPLICATION_TIMES' THEN #{regularShippingAdditionalDiscountApplicationTimes}
				WHEN PS_KEY = 'REGULAR_SHIPPING_ADDITIONAL_DISCOUNT_RATE' THEN #{regularShippingAdditionalDiscountRate}
				WHEN PS_KEY = 'REGULAR_SHIPPING_MAX_CUSTOMER_CYCLE' THEN #{regularShippingMaxCustomerCycle}
				WHEN PS_KEY = 'REGULAR_SHIPPING_PAYMENT_FAIL_TERMINATE' THEN #{regularShippingPaymentFailTerminate}
				END
		WHERE 1=1
		AND PS_KEY in
		('REGULAR_SHIPPING_BASIC_DISCOUNT_RATE'
		,'REGULAR_SHIPPING_ADDITIONAL_DISCOUNT_APPLICATION_TIMES'
		,'REGULAR_SHIPPING_ADDITIONAL_DISCOUNT_RATE'
		,'REGULAR_SHIPPING_MAX_CUSTOMER_CYCLE'
		,'REGULAR_SHIPPING_PAYMENT_FAIL_TERMINATE'
		)
	</update>

	<insert id="addPolicyRegularShipping">
        /*	PolicyRegularShipping.addPolicyRegularShipping	*/
        INSERT INTO PS_CONFIG(
				ST_SHOP_ID
				,PS_GRP_TP
				,PS_KEY
				,PS_NM
				,PS_VAL
				,COMMENT
				,USE_YN
				,CREATE_ID
		)
		VALUES
		(
				'1'
				,'223'
				,'REGULAR_SHIPPING_BASIC_DISCOUNT_RATE'
				,'정기배송 기본할인율'
				,#{regularShippingBasicDiscountRate}
				,'기본값 5%'
				,'Y'
				,'0'
			),
		(
				'1'
				,'223'
				,'REGULAR_SHIPPING_ADDITIONAL_DISCOUNT_APPLICATION_TIMES'
				,'정기배송 추가할인 적용회차'
				,#{regularShippingAdditionalDiscountApplicationTimes}
				,'기본값 3'
				,'Y'
				,'0'
			),
		(
				'1'
				,'223'
				,'REGULAR_SHIPPING_ADDITIONAL_DISCOUNT_RATE'
				,'정기배송 추가할인율'
				,#{regularShippingAdditionalDiscountRate}
				,'기본값 5'
				,'Y'
				,'0'
			),
		(
				'1'
				,'223'
				,'REGULAR_SHIPPING_MAX_CUSTOMER_CYCLE'
				,'정기배송 고객 배송주기'
				,#{regularShippingMaxCustomerCycle}
				,'기본값 없음'
				,'Y'
				,'0'
			),
		(
				'1'
				,'223'
				,'REGULAR_SHIPPING_PAYMENT_FAIL_TERMINATE'
				,'정기배송 결제실패시 강제종료'
				,#{regularShippingPaymentFailTerminate}
				,'기본값 없음'
				,'Y'
				,'0'
			)
    </insert>

</mapper>