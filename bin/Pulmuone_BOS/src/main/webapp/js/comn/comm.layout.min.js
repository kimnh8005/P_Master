var CLICKED_MENU_GRP_ID = '';
var CLICKED_MENU_ID     = '';
var CLICKED_MENU_URL    = '';
var MAIN_MENU_GROUP_LIST;
var MAIN_MENU_LIST;
var MENU_GROUP_MENU_LIST;
var swiper;
var sessionTimeOutTimerId = null;
/**------------------------------------------------------------사전 체크 시작 ------------------------------------------------------**/
//스크립트 실행
$(function() {
	var obj = new Object();
	obj["callback"] =  function(data){
		fnCheckSession(data);
	};

	fnGetSession( obj );
});
//세션호출
function fnGetSession( opt ) {
	$.ajax({
		url     :'/system/getSession',
		success :
		function( data ) {
			var callbacks = $.Callbacks();
		    callbacks.add( opt.callback );
		    callbacks.fire( data.data );
		}
	});
}

//쿠키값 가져오기
function getCookie(cookie_name) {
	var x, y;
	var val = document.cookie.split(';');

	for (var i = 0; i < val.length; i++) {
		x = val[i].substr(0, val[i].indexOf('='));
		y = val[i].substr(val[i].indexOf('=') + 1);
		x = x.replace(/^\s+|\s+$/g, ''); // 앞과 뒤의 공백 제거하기

		if (x == cookie_name) {
			return unescape(y); // unescape로 디코딩 후 값 리턴
		}
	}
}

function isSessionTimeOut() {
	var sessionExpireTime = getCookie("sessionExpireTime");
	var curTime = (new Date()).getTime();
	var leftSeconds = parseInt((sessionExpireTime - curTime)/1000);
	if (leftSeconds < 100) { // Server Time과 Client Time 차이를 고려하여 일단 100초로 설정(조정필요)
		clearInterval(sessionTimeOutTimerId);
		sessionTimeOutTimerId = null;
		fnLogoutProcess();
	}
}

//세션체크
function fnCheckSession(data) {

	if(data.session){
		PG_SESSION = data.session;

		if (sessionTimeOutTimerId != null) {
			clearInterval(sessionTimeOutTimerId);
			sessionTimeOutTimerId = null;
		}
		sessionTimeOutTimerId = setInterval(isSessionTimeOut, (60 * 1000)); // 1분에 한번씩 세션 체크(조정필요)

		//팝업일 경우 부모 권한 가지고감
		if(parent.MAIN_MENU_LIST){

			MAIN_MENU_LIST       = parent.MAIN_MENU_LIST;
			MAIN_MENU_GROUP_LIST = parent.MAIN_MENU_GROUP_LIST;
			MENU_GROUP_MENU_LIST = parent.MENU_GROUP_MENU_LIST;
			CLICKED_MENU_ID      = parent.CLICKED_MENU_ID;

			// ie 일경우 예외적으로 처리한다. kendoWindow ifrmae src 호출 문제로 아래와 같은 로직 추가
			/*
			if( USER_BROWSER.indexOf('ie') > -1 ){
				var convertThisURL = parent.CLICKED_MENU_URL.replace('#', '').split("?");
				var url = '';
				if(typeof convertThisURL === "string"){
					url += convertThisURL;
				}else{
					url += convertThisURL[0];
				}

				for(var zz=0; zz < MAIN_MENU_LIST.length; zz++){
					if( MAIN_MENU_LIST[zz].URL == url ){
						fnGoPage( { "url"      : MAIN_MENU_LIST[zz].URL
								   ,"menuId"   : MAIN_MENU_LIST[zz].MENU_ID
								   ,"menuGrpId": MAIN_MENU_LIST[zz].ST_MENU_GRP_ID
								  });
						break;
					}
				}
			}
			*/

		}else{
			fnInitLayout(data.session);
		}
	}else{
		fnGoLoginPage( false );
	}
}
/**------------------------------------------------------------사전 체크 끝 ------------------------------------------------------**/



/**------------------------------------------------------------메인 시작 ------------------------------------------------------**/
//1. 화면호출
function fnInitLayout( param ){
	fnGetMenuList( param  );

	// 상점 정보를 가져온다.
	$.ajax({
		url     :'/admin/comn/getShopInfo',
		success : function(result){
			var data = result.data;

		    MY_STORE_URL = data.rows.SITE_DOMAIN;
		}
	});
}
//2. 메뉴호출
function fnGetMenuList( param ){
	$('#indexUserInfo').text("["+param.companyName+"] "+ param.loginName + " 님" );
/*
	$('#indexUserInfo').unbind().bind('click', function(e){
		fnKendoPopup({
			id     : 'USER_LAYOUT_POPUP',
			title  : fnGetLangData({key :"6586",nullMsg :'개인정보 변경' }),
			src    : "#/emp003",
			width  : '660px',
			height : '570px',
			success: function( id, data ){

			}
		});

	});
*/
	$.ajax({
		url     :'/admin/comn/getMenuList',
		success : function(result){
			var data = result.data;

			if (result.data == null) {
				fnGoLoginPage( true );
				return;

			}

			//권한 설정되어있지 않는 경우
			if(data.rows.length ==0){
				fnGoLoginPage( true );
				return;
			}
			//권한 설정되어있지 않는 경우
			if(result.code =="400000002"){
				fnGoLoginPage( true );
				return;
			}
			//3. 메뉴 글로벌 변수 저장
			fnGlobalSetValue(data);

			//4. 메뉴 그리기 시작
			fnDrawStart(param);
		}
	});
}

/**------------------------------------------------------------메인 끝 ------------------------------------------------------**/

/**------------------------------------------------------------레이아웃 사용자 함수 시작------------------------------------------------------**/
//3. 메뉴 글로벌 변수 저장
function fnGlobalSetValue(data){
	MAIN_MENU_GROUP_LIST = data.rows;
	MAIN_MENU_LIST = data.menuList;
}

//4. 메뉴 그리기 시작
function fnDrawStart(session){

	//5. 메뉴그룹 상단 그리기
	fnDrawTopMenuGroup();

	//6. 메뉴상단 그리기
	fnDrawTopMenuMenu();

	//7.페이지 이동
	fnGoStartPage(session);

}

//5. 메뉴그룹 상단 그리기
function fnDrawTopMenuGroup(){
	var str ="";
	var allStr ="";
	MENU_GROUP_MENU_LIST = new Object();
	for(var i=0; i < MAIN_MENU_GROUP_LIST.length ; i++){
		MENU_GROUP_MENU_LIST[MAIN_MENU_GROUP_LIST[i].MENU_GRP_ID] = new Array();
		//-----START-------메뉴 그룹을 가져와서 그리기----------------------------
		str += '<div  class="menu swiper-slide" >';
		str += '<a onclick="fnGoMenuGroupPage({menuGrpId:'				+MAIN_MENU_GROUP_LIST[i].MENU_GRP_ID+','
		//str += '<a onclick="$scope.fnGoMenuGroupPage({menuGrpId:'				+MAIN_MENU_GROUP_LIST[i].MENU_GRP_ID+','
												+"menuGrpName : '"		+MAIN_MENU_GROUP_LIST[i].MENU_GRP_NAME+"'"
												+','+"menuGrpDefURL : '"+MAIN_MENU_GROUP_LIST[i].MENU_GRP_DEF_URL+"'"
												+','+"menuGrpDefPG : '"	+MAIN_MENU_GROUP_LIST[i].MENU_GRP_DEF_PG+"'"
												+','+"menuGrpClick : 'Y'"
											+'  })"  >';
		str += MAIN_MENU_GROUP_LIST[i].MENU_GRP_NAME+' </a>';
	   	//-----END-------메뉴 그룹을 가져와서 그리기----------------------------
	   	str += ' <ul id="menuGrpId'+MAIN_MENU_GROUP_LIST[i].MENU_GRP_ID+'" class="submenu">';
	   	str += '</ul>';
	   	str += '</div>';

//	   	if(i<7){
//	   		allStr+='<section id=sectionAllMenu'+i+'>';
//	   		allStr+='<div id=divAllMenu'+MAIN_MENU_GROUP_LIST[i].MENU_GRP_ID+' class="section-depth">';
//		   	allStr+='<h2>';
//		   	allStr+=MAIN_MENU_GROUP_LIST[i].MENU_GRP_NAME;
//		   	allStr+='</h2>';
//		   	allStr+='</div>';
//		   	allStr+='</section>';
//	   	}else if(i==7){
//	   		$('#menu-all-area').html(allStr);
//	   		allStr="";
//	   		allStr+='<div id=divAllMenu'+MAIN_MENU_GROUP_LIST[i].MENU_GRP_ID+' class="section-depth">';
//		   	allStr+='<h2>';
//		   	allStr+=MAIN_MENU_GROUP_LIST[i].MENU_GRP_NAME;
//		   	allStr+='</h2>';
//		   	allStr+='</div>';
//		   	$('#sectionAllMenu'+i%7).append(allStr);
//	   	}else{
//	   		allStr="";
//	   		allStr+='<div id=divAllMenu'+MAIN_MENU_GROUP_LIST[i].MENU_GRP_ID+' class="section-depth">';
//		   	allStr+='<h2>';
//		   	allStr+=MAIN_MENU_GROUP_LIST[i].MENU_GRP_NAME;
//		   	allStr+='</h2>';
//		   	allStr+='</div>';
//		   	$('#sectionAllMenu'+i%7).append(allStr);
//	   	}

   		if(i%7== 0) allStr+='<div style="display: table-row">';

		allStr+='<section id=sectionAllMenu'+i+'>';
   		allStr+='<div id=divAllMenu'+MAIN_MENU_GROUP_LIST[i].MENU_GRP_ID+' class="section-depth">';
	   	allStr+='<h2>';
	   	allStr+=MAIN_MENU_GROUP_LIST[i].MENU_GRP_NAME;
	   	allStr+='</h2>';
	   	allStr+='</div>';
	   	allStr+='</section>';

	   	if(i%7 == 6) allStr+='</div>';

	   	$('#menu-all-area').html(allStr);
	}
	//MENU GROUP을 그린다.
	$('#naviMenuGroup').html(str);
	if(MAIN_MENU_GROUP_LIST.length<8){
		$('#menu-all-area').html(allStr);
	}

}

//6. 메뉴상단 그리기
function fnDrawTopMenuMenu(){
	var maxLevel =2;
   	for(var i=0; i < MAIN_MENU_LIST.length ; i++){

    if (MENU_GROUP_MENU_LIST[MAIN_MENU_LIST[i].ST_MENU_GRP_ID] != undefined) {
      // 그룹이 존재하는 경우에만 처리
        if(MAIN_MENU_LIST[i].POP_YN =='N'){
          MENU_GROUP_MENU_LIST[MAIN_MENU_LIST[i].ST_MENU_GRP_ID].push(MAIN_MENU_LIST[i]);
          if(MAIN_MENU_LIST[i].LV ==2 ){
            var obj = new Object();
            obj["id"] 	=   "topMenuItem";
            obj["menuId"] 	= MAIN_MENU_LIST[i].MENU_ID;
            obj["url"] 		= MAIN_MENU_LIST[i].URL;
            obj["menuName"] = MAIN_MENU_LIST[i].MENU_NAME;
            obj["menuGrpName"] = MAIN_MENU_LIST[i].MENU_GRP_NAME;
          obj["menuGrpId"] = MAIN_MENU_LIST[i].ST_MENU_GRP_ID;
            var str="";
            var allMenuStr ="";
            if(MAIN_MENU_LIST[i].MENU_TYPE =='02'){
            str+= '<li>'+'<a>'+ obj["menuName"]  +'</a> </li>';
            allMenuStr+= '<a>'+ obj["menuName"]  +'</a>';
            }else{
              str+= '<li >' +fnTagHtml2(obj) + '</li>';
              allMenuStr+= fnTagHtml2(obj);
            }
          str+='<span id="topMenuId'+MAIN_MENU_LIST[i].MENU_ID+'">';
          str+='</span>';
          allMenuStr+='<span id="allTopMenuId'+MAIN_MENU_LIST[i].MENU_ID+'">';
          allMenuStr+='</span>';

          $('#menuGrpId'+MAIN_MENU_LIST[i].ST_MENU_GRP_ID).append(str);



          $('#divAllMenu'+MAIN_MENU_LIST[i].ST_MENU_GRP_ID).append(allMenuStr);

          }
        }
        if(maxLevel < MAIN_MENU_LIST[i].LV ){
          maxLevel = MAIN_MENU_LIST[i].LV;
        }
      } // End of if (MENU_GROUP_MENU_LIST[MAIN_MENU_LIST[i].ST_MENU_GRP_ID] != undefined)
   	}
   	for(var i =3; i<=maxLevel ; i++){
   		for(var j=0; j< MAIN_MENU_LIST.length ;j++){
   			if(MAIN_MENU_LIST[j].LV ==i ){
	   			if(MAIN_MENU_LIST[j].POP_YN =='N'){
	   				var obj = new Object();
	   				obj["id"] 	=   "topMenuItem";
	   				obj["menuId"] 	= MAIN_MENU_LIST[j].MENU_ID;
	   				obj["url"] 		= MAIN_MENU_LIST[j].URL;
	   				obj["menuName"] = MAIN_MENU_LIST[j].MENU_NAME;
					obj["menuGrpName"] = MAIN_MENU_LIST[j].MENU_GRP_NAME;
					obj["menuGrpId"] = MAIN_MENU_LIST[j].ST_MENU_GRP_ID;

					var str=fnTagHtml2(obj);

					$('#topMenuId'+MAIN_MENU_LIST[j].P_MENU_ID).append(str);
					$('#allTopMenuId'+MAIN_MENU_LIST[j].P_MENU_ID).append(str);
	   			}
			}
   		}
   	}
}
function fnGetSwiper(){
	if(swiper){
		return;
	}
	swiper=	new Swiper('#navigation .swiper-container', {
		scrollbar: '.swiper-scrollbar',
		scrollbarHide: true,
		slidesPerView: 'auto',
		spaceBetween: 0,
		grabCursor: true
	});
}


//8.페이지 이동
function fnGoStartPage(session){
	//var preURL =document.referrer;
	var preURL =location.href;
	var thisURL = preURL.substring(preURL.lastIndexOf("/") +1, preURL.length);
	var convertThisURL = thisURL.split("?");

	//----------현재 URL----------------------------
	var url="/";
	if(typeof convertThisURL === "string"){
		url+=thisURL;
	}else{
		url+=convertThisURL[0];
	}
	var companyType = session.companyType;
	var defURL = "";
	switch(companyType) {
		case 'COMPANY_TYPE.HEADQUARTERS' :
		case 'COMPANY_TYPE.CLIENT' :
			defURL ='/dashboardTot';
		break;
	}

//	if(thisURL =="layout.html" || thisURL =="admVerify.html"){
	if(thisURL =="layout.html" || thisURL =="admVerify.html" || thisURL =="layout.html#") {
		if(defURL !=""){
			var objParam = foGetPageByURL(defURL);
			if(objParam != null){
				fnGoPage({"url": objParam.url,"menuId" : objParam.menuId,"menuGrpId": objParam.menuGrpId});
				return;
			}else{
				fnGoPageNoLeft({"url": '#' + defURL});
				return;
			}
		}

		loop1:
		for(var i=0; i < MAIN_MENU_LIST.length ; i++){
   			if(MAIN_MENU_LIST[i].POP_YN =='N'){
	   			if(MAIN_MENU_LIST[i].LV >=2 && MAIN_MENU_LIST[i].URL != "/#"){
	   				fnDrawLeftMenu( MAIN_MENU_LIST[i].ST_MENU_GRP_ID );
	   				var checkURL =fnGetPageByMenuGrpDefURL( MAIN_MENU_LIST[i].ST_MENU_GRP_ID  );
	   				if(checkURL != ""){
	   					var objParam = foGetPageByURL(checkURL);
	   					fnGoPage({"url": objParam.url,"menuId" : objParam.menuId,"menuGrpId": MAIN_MENU_LIST[i].ST_MENU_GRP_ID});
	   					return;
	   				}else{
	   					fnGoPage({"url": '#'+MAIN_MENU_LIST[i].URL,"menuId" : MAIN_MENU_LIST[i].MENU_ID,"menuGrpId": MAIN_MENU_LIST[i].ST_MENU_GRP_ID});
	   					return;
	   				}
   				}
   			}
   		}
	}else{
		loop2:
		if( url == '/dashboardTot' || url == '/dashboardComp' || url == '/dashboardShop'
			|| url =='/ecprocList'){
			fnGoPageNoLeft({"url": '#' + url});
			return;
		}else{
			for(var i=0; i < MAIN_MENU_LIST.length ; i++){
	   			if(MAIN_MENU_LIST[i].LV >=2 && MAIN_MENU_LIST[i].URL != "/#"){
	   				if(url == MAIN_MENU_LIST[i].URL.split('?')[0]){
						return;
	   				}
				}
	   		}
		}
	}

	if (!(PG_SESSION == null || PG_SESSION == undefined || PG_SESSION == '' || PG_SESSION == 'undefined')) {
		fnGoPageNoLeft({"url": '#' + defURL});
	}
	else {
		fnGoLoginPage(true);
	}
}





function foGetPageByURL(paramURL){
	var url ="";
	var menuId ="";
	var menuGrpId ="";
	loop2:
	for(var i=0; i < MAIN_MENU_LIST.length ; i++){
		if(MAIN_MENU_LIST[i].LV >=2 ){
			if(paramURL == MAIN_MENU_LIST[i].URL){
   				url = MAIN_MENU_LIST[i].URL;
   				menuId = MAIN_MENU_LIST[i].MENU_ID;
   				menuGrpId = MAIN_MENU_LIST[i].ST_MENU_GRP_ID;
				break loop2;
			}
		}
	}
	if(menuGrpId !=""){
		return {"url": '#'+url,"menuId" : menuId,"menuGrpId": menuGrpId};
	}else{
		return null;
	}
}
function fnGetPageByMenuGrpDefURL( menuGrpId ){
	loop1:
	for(var i = 0; i <MAIN_MENU_GROUP_LIST.length ; i++){
		if(MAIN_MENU_GROUP_LIST[i].MENU_GRP_ID == menuGrpId){
			return  MAIN_MENU_GROUP_LIST[i].MENU_GRP_DEF_URL;
		}
	}
	return null;
}


function fnGoMenuGroupPage( obj ){
	$('.menu-all-area').removeClass('active');
	fnDrawLeftMenu( obj.menuGrpId );
	var checkURL =fnGetPageByMenuGrpDefURL( obj.menuGrpId  );
	if(checkURL != ""){
		var objParam = foGetPageByURL(checkURL);
		fnGoPage({"url": objParam.url,"menuId" : objParam.menuId,"menuGrpId":obj.menuGrpId});
	}else{
		loop3:
		for(var i=0; i < MENU_GROUP_MENU_LIST[obj.menuGrpId].length ; i++){
	   		if(MENU_GROUP_MENU_LIST[obj.menuGrpId][i].LV >=2 && MENU_GROUP_MENU_LIST[obj.menuGrpId][i].URL != "/#"){
	   			fnGoPage({"url": '#'+MENU_GROUP_MENU_LIST[obj.menuGrpId][i].URL,"menuId" : MENU_GROUP_MENU_LIST[obj.menuGrpId][i].MENU_ID,"menuGrpId":obj.menuGrpId});
				break loop3;
			}
	   	}
	}
}
function fnDrawLeftMenu( menuGrpId ){
	if (MENU_GROUP_MENU_LIST[menuGrpId] == undefined)
		return;

	$('.menu-all-area').removeClass('active');
	var maxLevel =2;
	$('#lnbMenuList').html("");
   	for(var i=0; i < MENU_GROUP_MENU_LIST[menuGrpId].length ; i++){
   		if(MENU_GROUP_MENU_LIST[menuGrpId][i].LV ==2 ){
			var str="";
			var obj = new Object();
			obj["id"] 	=   "lnb";
			obj["menuId"] 	= MENU_GROUP_MENU_LIST[menuGrpId][i].MENU_ID;
			obj["url"] 		= MENU_GROUP_MENU_LIST[menuGrpId][i].URL;
			obj["menuName"] = MENU_GROUP_MENU_LIST[menuGrpId][i].MENU_NAME;
			obj["menuGrpName"] = MENU_GROUP_MENU_LIST[menuGrpId][i].MENU_GRP_NAME;
			obj["menuGrpId"] = MENU_GROUP_MENU_LIST[menuGrpId][i].ST_MENU_GRP_ID;
			obj["menuDepth"] = "2";
			if(MENU_GROUP_MENU_LIST[menuGrpId][i].MENU_TYPE =='02'){
				str+= '<li>'+'<a class="show">'+ obj["menuName"]  +'</a>';
   			}else{
   				str+= '<li>'+fnTagHtml(obj);
   			}
			str+='<span id="lnbTopMenuId'+ obj["menuId"] +'"'+'class="removeFindMenu"  >';
			str+='</span>';
			str+='</li>';
			$('#lnbMenuList').append(str);
		}
		if(maxLevel < MENU_GROUP_MENU_LIST[menuGrpId][i].LV ){
			maxLevel = MENU_GROUP_MENU_LIST[menuGrpId][i].LV;
		}
   	}
   	for(var i =3; i<=maxLevel ; i++){
   		for(var j=0; j< MENU_GROUP_MENU_LIST[menuGrpId].length ;j++){
   			if(MENU_GROUP_MENU_LIST[menuGrpId][j].LV ==i ){
	   			if(MENU_GROUP_MENU_LIST[menuGrpId][j].POP_YN =='N'){
	   				var obj = new Object();
	   				obj["id"] 	=   "lnb";
	   				obj["menuId"] 	= MENU_GROUP_MENU_LIST[menuGrpId][j].MENU_ID;
	   				obj["url"] 		= MENU_GROUP_MENU_LIST[menuGrpId][j].URL;
	   				obj["menuName"] = MENU_GROUP_MENU_LIST[menuGrpId][j].MENU_NAME;
					obj["menuGrpName"] = MENU_GROUP_MENU_LIST[menuGrpId][j].MENU_GRP_NAME;
					obj["menuGrpId"] = MENU_GROUP_MENU_LIST[menuGrpId][j].ST_MENU_GRP_ID;
					obj["menuDepth"] = "3";
					var str=fnTagHtml(obj);

					$('#lnbTopMenuId'+MENU_GROUP_MENU_LIST[menuGrpId][j].P_MENU_ID).append(str);
	   			}
			}
   		}
   	}
   	$.each($('.removeFindMenu'), function(idx, row){
   		if($(row).has( "a" ).length==0){
   			$(row).remove();
   		}
   	});
   	fnLnbControl();
}
function fnTagHtml(obj){
    var goPage = '"fnGoPage({url:'+"'#"+obj["url"]+"'"+',menuId : '+obj["menuId"]+',menuGrpName : '+"'"+obj["menuGrpName"]+"'"+",menuGrpId : "+obj["menuGrpId"]+',evt:event})"';
	var str = '<a id="'+obj["id"]+obj["menuId"] +'" '
	                    +'onclick=' + goPage + '" '
                        +'oncontextmenu=' + goPage + '" '
	                    +'style="cursor:pointer"' +" "
						+'data-menu_depth="'+obj["menuDepth"]+'" '
						+ '"><span>'
				+obj["menuName"]+'</span></a>';
	return str;
}
function fnTagHtml2(obj){
    var goPage = '"fnGoPage({url:'+"'#"+obj["url"]+"'"+',menuId : '+obj["menuId"]+',menuGrpName : '+"'"+obj["menuGrpName"]+"'"+",menuGrpId : "+obj["menuGrpId"]+',refresh:1,evt:event})"';
	var str = '<a id="'+obj["id"]+obj["menuId"] +'" '
	                    +'onclick=' + goPage + '" '
	                    +'oncontextmenu=' + goPage + '" '
	                    +'style="cursor:pointer"><span>'
				+obj["menuName"]+'</span></a>';
	return str;
}
function fnLnbControl() {
	var $this = $('.lnb-sub li > a');
	$this.on('click',function() {
		$(this).toggleClass('close');
	});
}
function fnGoLoginPage( param ){
	if(param){
		var sum=4;
		setInterval(function(e){
			if(sum==0){
				fnLogoutProcess();
			}else{
				sum--;
			}
			$('#forbizMsgBox').text(sum);
		}, 1000);
		fnKendoMessage({message : "<div id=''>권한이 설정되어 있지 않습니다  <br/><span id='forbizMsgBox'>5</span>초 후 로그인페이지로 이동합니다.</div>"  ,ok :function(e){
			fnLogoutProcess();
		}});
	}else{
    	//alert("comm layout. min  fnGoLoginPage() ");
		alert("로그인이 필요합니다.");

		location.href = 'admVerify.html';
	}
}


/**
 * 페이지 정보를 호출한다.
 * @param {Object} opt
 *
 * ex))
 *
 * url    : #/stcc002
 * data	  : {a:b,c:d,e:f}
 * menuId : 27000006
 */
function fnGoPage( opt ){
    if(opt.evt !== undefined){
        if ( opt.evt.ctrlKey ) {
            window.open(opt.url);
            return;
        }
        if (opt.evt.which === 3 || opt.evt.button === 2) {
            window.open(opt.url);
            return;
        }
    }

	CLICKED_MENU_GRP_ID = opt.menuGrpId;

	if( opt.menuGrpId == '39' ){
		$('div.member-bar').show();
		//$('div#ng-view').css('padding-top', '25px');
		$('div#contents').css({'padding-top':'55px'});
	}else{
		$('div.member-bar').hide();
		// $('div#contents').css('padding-top', '30px');
	}

	if(opt.menuGrpName !==undefined){
		$('#lnbTitle').text(opt.menuGrpName);
	}
	if(opt.menuGrpId !==undefined){
		if(opt.refresh !== undefined){
			fnDrawLeftMenu( CLICKED_MENU_GRP_ID );
		}
		$('#navigation').find('.active').removeClass('active');
		$('#menuGrpId'+opt.menuGrpId).parent().children('a').addClass("active");
	}

	if(opt.url ===undefined){
		alert(" opt.url 필수입니다. EX)  opt.url='#/dic' ");
		return;
	}

	if(opt.data !==undefined){
		opt.url+="?"+Object.keys(opt.data).map(function(k) {
		    return encodeURIComponent(k) + '=' + encodeURIComponent(opt.data[k]);
		}).join('&');
	}

	$('#lnb').find('.active').removeClass('active');
	$('#naviMenuGroup').find('.textactive').removeClass('textactive');
	if(opt.menuId !==undefined){
		CLICKED_MENU_ID = opt.menuId;
		$("#lnb"+opt.menuId).addClass('active');
		$("#lnb"+opt.menuId).parent().parent().children('a').addClass('active');
		$("#topMenuItem"+opt.menuId).addClass('textactive');

		$('article#container').removeClass('no-lnb');
		location.href   = opt.url;

	/*

		if( PG_SESSION.ceCnclYn == 'N' ){

			if( opt.url != '#/ecprocList' ){
				console.log( '-------------->>> ' + opt.url);
				if( opt.url.indexOf('#/ecprocView') > -1 ){
					location.href   = "/"+opt.url;
					return;
				}else{
					fnKendoMessage({message : fnGetLangData({key :"6354",nullMsg :'전자계약 체결 완료 후 다시 로그인 후 사용해주세요.' }) ,ok :function(){}});
				}
			}

			fnGoPageNoLeft({"url": '#/ecprocList'});
		}else{
			$('article#container').removeClass('no-lnb');
			location.href   = opt.url;
			//angular.element(document.getElementById('document')).scope().goPage(opt);

		}
*/
	}else{
		//alert(" opt.menuId 필수입니다. EX)  opt.menuId = 54 ");
	}
}

/**
 * 페이지 정보를 호출한다.
 * @param {Object} opt
 *
 * ex))
 * url    : #/stcc002
 */
function fnGoPageNoLeft( opt ){
	$('article#container').addClass('no-lnb');
	location.href = opt.url;
}

/**
 * 로그아웃
 * 참고 : 여러 페이지에서 사용함.
 */
function fnLogoutProcess(){
	//alert(" comm.layout  min  fnLogoutProcess()  ");
	$.ajax({
        url     : "/admin/login/delLoginData",
		 type    : 'POST',
        success : function( data ){
            location.href = '/admVerify.html';
        }
   });
}


/**
 * 새 페이지 정보 호출
 * @param url : 열고자 하는 화면 URL (필수)
 * @param target : 화면 target (필수)
 * @param data : 파라미터 데이터
 */
function fnGoNewPage( opt ){

    if( opt.url === undefined ){
        fnKendoMessage({ message : "opt.url 필수입니다. EX)  opt.url='#/dic'"});
        return;
    }

    if( opt.target === undefined ){
        fnKendoMessage({ message : "opt.target 필수입니다. EX)  opt.target='dic'"});
        return;
    }

    let baseUrl = window.location.origin + "/layout.html";
    let url = baseUrl + opt.url

    if( opt.data !== undefined ){
        url += "?" + Object.keys(opt.data).map(function(k) {
            return encodeURIComponent(k) + '=' + encodeURIComponent(opt.data[k]);
        }).join('&');
    }

    window.open(url, opt.target);
};

/**------------------------------------------------------------레이아웃 사용자 함수 끝------------------------------------------------------**/