<!-- wrap-location -->
<div class="wrap-location">
    <!-- 도움말 설정 : 메뉴 케이스 -->
    <div class="title">
        <h2>풀무원_리스트 3</h2>
        <div data-help-title="help title 1" data-help-message="help-message 1">
        </div>
    </div>
    <span class="location">상품관리 &gt; 상품 기초정보 &gt; 상품분류 관리</span>
</div>
<!-- wrap-location End-->

<div class="fb__sect">
    <!-- Form Section-->
    <form id="searchForm" name="searchForm" novalidate="novalidate" enctype="multipart/form-data">
        <!-- table -->
        <table class="datatable v-type">
            <colgroup>
                <col width="12%" />
                <col width="38%" />
                <col width="12%" />
                <col width="38%" />
            </colgroup>
            <tbody>
                <!-- 행1 : 노출타입 -->
                <tr>
                    <th>
                        <span class="req-star-front">
                            노출타입
                            <div data-help-title="help title 1" data-help-message="help-message 1">
                            </div>
                        </span>
                    </th>
                    <td>
                        <div class="complex-condition" style="width: 100%">
                            <div class="fb__custom__radio">
                                <label>
                                    <input type="radio" name="showType" value="text" checked="checked" />
                                    <span>텍스트</span>
                                </label>
                                <label>
                                    <input type="radio" name="showType" value="img" />
                                    <span>이미지</span>
                                </label>
                            </div>
                        </div>
                    </td>
                    <th>
                        검색어 관리명
                    </th>
                    <td>
                        <div class="complex-condition" style="width: 100%">
                            <input type="text" name="keywordManage" id="keywordManage" class="comm-input"
                                style="width: 300px" />
                        </div>
                    </td>
                </tr>
                <!-- 행2 : 노출 키워드 -->
                <tr>
                    <th>
                        <span class="req-star-front">
                            노출 키워드
                        </span>
                    </th>
                    <td colspan="3">
                        <div class="complex-condition" style="width: 100%">
                            <input type="text" name="keyword" id="keyword" class="comm-input" style="width: 300px"
                                required data-validator-required="true" />
                        </div>
                    </td>
                </tr>
                <!-- 행3 : 이미지 등록 -->
                <!-- itemMgm & itemMgmController.js 참고 -->
                <tr>
                    <th>
                        이미지 등록
                        <div data-help-title="이미지 등록 도움말" data-help-message="이미지 등록 메시지"></div>
                    </th>
                    <td colspan="3">
                        <div class="addImage-container">
                            <div id="add-image" class="addImage">
                                <div class="addImage__image-wrapper">
                                    <figure>
                                        <img class="addImage__image" src="/contents/images/common/add-image-noti.png"
                                            alt="add-image-noti.png" title="이미지를 추가해주세요" />
                                    </figure>
                                </div>
                                <div class="addImage__btn-wrapper">
                                    <button type="button" class="addImage__addBtn">
                                        이미지 추가
                                    </button>
                                    <input type="file" name="imageFile" class="fileInput" style="display: none" />
                                </div>
                            </div>
                        </div>
                    </td>
                </tr>
                <!-- 행4 : URL-->
                <tr>
                    <th>URL</th>
                    <td colspan="3">
                        <div class="complex-condition" style="width: 100%">
                            <input type="text" name="urlName" id="urlName" class="comm-input" style="width: 100%" />
                        </div>
                    </td>
                </tr>
                <!-- 행5 : 노출기간 -->
                <tr>
                    <th scope="row">
                        <span class="req-star-front"> 노출기간 </span>
                    </th>
                    <td colspan="3">
                        <div class="complex-condition" style="width: 100%">
                            <div class="datepicker-wrapper startdate-wrapper" style="width: 140px">
                                <input type="text" id="startDate" class="datepicker-input" name="startDate" />
                            </div>

                            <!-- 종료 Datepicker -->
                            <div class="datepicker-wrapper">
                                <input type="text" id="endDate" class="datepicker-input" name="endDate" />
                            </div>
                        </div>
                    </td>
                </tr>
                <!-- 행6 : 대상 -->
                <tr>
                    <th>대상</th>
                    <td>
                        <div class="complex-condition" style="width: 100%">
                            <div class="fb__custom__radio">
                                <label>
                                    <input type="radio" name="targetType" value="all" checked="checked" />
                                    <span>전체</span>
                                </label>
                                <label>
                                    <input type="radio" name="targetType" value="category" />
                                    <span>카테고리별</span>
                                </label>
                            </div>
                        </div>
                    </td>
                    <th>
                        <span class="req-star-front">사용여부</span>
                    </th>
                    <td>
                        <div class="complex-condition" style="width: 100%">
                            <div class="fb__custom__radio">
                                <label>
                                    <input type="radio" name="useYn" value="Y" checked="checked" />
                                    <span>예</span>
                                </label>
                                <label>
                                    <input type="radio" name="useYn" value="N" />
                                    <span>아니오</span>
                                </label>
                            </div>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
        <!-- table End -->

        <!-- button area-->
        <div class="btn-area">
            <button id="fnSearch" class="btn-point btn-l" type="submit">
                저장
            </button>
            <button id="fnClear" class="btn-white btn-l" type="button">
                초기화
            </button>
        </div>
        <!-- button area End -->
    </form>
</div>

<script>
    "use strict";

    // fnInitialize();	//Initialize Page Call ---------------------------------
    // fnHelp();       //Initialize Help call ---------------------------------

    //Initialize PageR
    function fnInitialize() {
        $scope.$emit("fnIsMenu", { flag: true });

        fnPageInfo({
            PG_ID: "sampleList3",
            callback: null
        });
    };

    function initTemplate() {
        // template elements
        var $document = $(document);

        //data
        var fbData = {
            //로딩
            fetches: {},

            //api요청 파라미터
            requests: {},

            //데이터
            data: {},
        };

        /************************** Functions *******************************/
        /**
         * 	유효성검사
         *  data-validator-required 필수값 여부 html 엘리먼트에 추가
         *  data-validator-reg 정규식 여부 필요한 경우 html 엘리먼트에 추가 없으면 빈 값만 체크
         */
        function validator(requestObj) {
            var result = true;
            for (var [key, value] of Object.entries(requestObj)) {
                var $target = $("[name=" + key + "]");
                var isRequired = $target.attr("data-validator-required");

                if (isRequired) {
                    if (value == "") {
                        result = false;
                    } else {
                        var isReg = $target.attr("data-validator-reg");
                        var makeReg = new RegExp(isReg, "g");

                        if (isReg && !makeReg.test(value)) {
                            result = false;
                        }
                    }
                }
            }

            return result;
        }

        // 데이트피커 초기화
        function initDatePicker() {
            fnKendoDatePicker({
                id: 'startDate',
                format: 'yyyy-MM-dd',

            });

            fnKendoDatePicker({
                id: 'endDate',
                format: 'yyyy-MM-dd',
                btnStyle: true,
                btnStartId: 'startDate',
                btnEndId: 'endDate',
            });
        }

        function setDate(_day = 7) {
            //오늘 날짜
            var todayDate = new Date();
            var startTime = "";

            if (!isNaN(_day)) {
                _day = _day * 24 * 60 * 60 * 1000;
                startTime = new Date(todayDate - _day);
                $("#startDate").val(startTime.oFormat("yyyy-MM-dd"));
                $("#endDate").val(todayDate.oFormat("yyyy-MM-dd"));
            } else {
                $("#startDate").val("");
                $("#endDate").val("");
            }
        }

        function clearForm($form) {
            if (!$form) return;

            $form.find("input,select,textarea").each(function () {
                var self = $(this);

                //textarea 태그인 경우
                if (self.is("textarea")) {
                    self.val("");
                }
                //input 태그 인 경우
                else if (self.is("input")) {
                    switch (self.attr("type")) {
                        case "text":
                        case "email":
                        case "password":
                            self.val("");
                            break;
                        case "checkbox":
                        case "radio":
                            self.prop("checked", false);
                            break;
                        default:
                            break;
                    }
                }
                //select 태그인 경우
                else if (self.is("select")) {
                    self.find("option").eq(0).prop("selected", true);
                }
                // 그 외의 경우
                else {
                    self.val("");
                }
            });
        }

        function requestSearch(parameter) {
            fbLoading(true);

            try {
                console.log(parameter);
                //api연동
                setTimeout(function () {
                    fbLoading(false);
                }, 1000);
            } catch (ex) {
                console.error("requestSearch has exception...", ex);
            }
        }

        function readURL(input) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();

                reader.onload = function (e) {
                    //변경
                    /*var target = document.querySelector('#add-image img');

                        if(target){
                            target.setAttribute('src',e.target.result);
                            //target.dataset['data-bind'] = e.target.result;
                        }else{
                            return;
                        }*/
                    //추가
                    // var container = document.querySelector(
                    //     ".addImage-container"
                    // );

                    var $container = $(".addImage-container");

                    if (!$container.length) return;

                    var imageURL = e.target.result;

                    //image template
                    var imageTemplate =
                        "<div class='addImage'>" +
                        "<div class='addImage__image-wrapper'>" +
                        "<figure>" +
                        "<img class='addImage__image' src='" +
                        imageURL +
                        "' data-bind='" +
                        imageURL +
                        "' alt='add-image-noti.png' title='이미지를 추가해주세요'/>" +
                        "</figure>" +
                        "</div>" +
                        "<div class='addImage__btn-wrapper'>" +
                        "<button type='button' class='addImage__removeBtn'>이미지 제거</button>" +
                        "<input type='file' name='imageFile' class='fileInput' style='display: none'/>" +
                        "</div>" +
                        "</div>";

                    var $newEl = $(imageTemplate);

                    $container.append($newEl);
                    input.value = "";
                };

                // convert to base64 string
                reader.readAsDataURL(input.files[0]);
            }
        }

        function initRadios() {
            $(".fb__custom__radio").each(function () {
                $(this).find("label:first-child > input").prop("checked", true);
            });
        }

        /*****************************************************************/

        /************************** 이벤트 *******************************/

        function onSubmit() {
            $("#searchForm").on("submit", function (e) {
                e.preventDefault();
                var $this = $(this);
                var requestObj = fbSerializeForm($this);
                if (requestObj) {
                    requestSearch(requestObj);
                } else {
                    return;
                }
            });
        }

        function onRemoveImage() {
            $document.on("click", ".addImage__removeBtn", function (e) {
                var $this = $(this);
                var target = e.target.closest(".addImage");
                $(target).remove();
            });
        }

        function onAddImage() {
            $document.on("change", ".fileInput", function (e) {
                readURL(this);
            });
        }

        function onClickAddImage() {
            $document.on("click", ".addImage__addBtn", function () {
                var $this = $(this);
                var $fileInputBtn = $this.parent().find(".fileInput");
                if (!$fileInputBtn.length) return;

                $fileInputBtn.trigger("click");
            });
        }

        function onClear() {
            $("#fnClear").on("click", function () {
                var $form = $(this).closest("form");

                if (!$form.length) return;

                clearForm($form);

                $("#add-image")
                    .siblings()
                    .each(function () {
                        $(this).remove();
                    });

                initRadios();
            });
        }
        /*****************************************************************/

        //init 함수
        function init() {
            onClear();
            onClickAddImage();
            onAddImage();
            onRemoveImage();
            onSubmit();
            initDatePicker();
        }

        init();
    };



    initTemplate();
</script>