<!-- wrap-location -->
<div class="wrap-location">
    <h2 class="title">풀무원_리스트 2</h2>
    <span class="location">상품관리 &gt; 상품 기초정보 &gt; 상품분류 관리</span>
</div>
<!-- wrap-location End-->

<!-- Form Section-->
<div class="fb__sect">
    <form id="searchForm" name="searchForm" novalidate="novalidate">
        <!-- table -->
        <table class="datatable v-type">
            <colgroup>
                <col width="15%" />
                <col width="*" />
            </colgroup>
            <tbody>
                <!-- 행1 : 유저 아이디 -->
                <tr>
                    <th>
                        <span class="req-star-front">유저 아이디</span>
                    </th>
                    <td>
                        <div class="complex-condition" style="width: 100%">
                            <input type="text" name="userId" id="userId" class="comm-input" style="width: 300px"
                                data-validator-required="true" required />
                        </div>
                    </td>
                </tr>
                <!-- 행2 : 쿠폰 사용일 -->
                <tr>
                    <th scope="row">쿠폰 사용일</th>
                    <td>
                        <div class="complex-condition" style="width: 100%">
                            <!-- 시작 Datepicker -->
                            <div class="datepicker-wrapper startdate-wrapper" style="width: 140px">
                                <input type="text" id="startDate" class="datepicker-input" name="startDate" />
                            </div>

                            <!-- 종료 Datepicker -->
                            <div class="datepicker-wrapper">
                                <input type="text" id="endDate" class="datepicker-input" name="endDate" />
                            </div>
                        </div>
                        <span class="cell__desc req-star">
                            회원의 전체쿠폰 목록을 보시려면 쿠폰사용일 항목을 초기화 후 검색하면 데이터를 볼 수 있습니다.
                        </span>
                    </td>
                </tr>
                <!-- 행3 : 사용가능 여부 -->
                <tr>
                    <th scope="row"><label>사용가능 여부</label></th>
                    <td>
                        <div class="complex-condition">
                            <div class="fb__custom__checkbox">
                                <!-- 체크 박스 영역 -->
                                <label>
                                    <input type="checkbox" name="useStatus" data-check="all" checked="checked" />
                                    <span>전체</span>
                                </label>
                                <label>
                                    <input type="checkbox" name="useStatus""
                                    value=" use" checked="checked" />
                                    <span>사용전</span>
                                </label>
                                <label>
                                    <input type="checkbox" name="useStatus" value="notUse" checked="checked" />
                                    <span>사용완료</span>
                                </label>
                            </div>
                        </div>
                    </td>
                </tr>
                <tr>
                    <th scope="row">데이트피커 테스트</th>
                    <td>
                        <div style="width: 100%">
                            <!-- 
                                <가이드 - 데이트 피커 &  타임피커 드롭다운 형식> 
                                0. div.datepicker-wrapper 로 묶어서 사용, 안에 3개의 input이 들어감
                                1. datepicker api를 통해 생성하는 input을 제외하고 아래 두개의 input에는 fb__timepicker 클래스 적용 필수
                                2. id, name값은 임의로 지정 가능합니다.
                                3. .fb__timepicker 클래스가 적용된 엘리먼트에 fbMakeTimePicker() 함수를 통해서 각 input을 켄도 dropdownlist 형식으로 만듭니다.
                                4. 시간 드롭다운 리스트의 경우 fbMakeTimePicker("#startHourPicker","hour");
                                5. 분 드롭다운 리스트의 경우 fbMakeTimePicker("#startMinPicker","min");
                            -->
                            <div class="datepicker-wrapper startdate-wrapper">
                                <input type="text" id="startPickerTest" class="comm-input">
                                <input id="startHourPicker" type="text" name="startHour" class="fb__timepicker" />
                                <input id="startMinPicker" type="text" name="startMin" class="fb__timepicker" />
                                </input>
                            </div>


                            <!-- 종료 Datepicker -->
                            <div class="datepicker-wrapper">
                                <input type="text" id="endPickerTest" class="comm-input">
                                <input id="endHourPicker" type="text" name="endHour" class="fb__timepicker" />
                                <input id="endMinPicker" type="text" name="endMin" class="fb__timepicker" />
                            </div>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
        <!-- table End -->

        <!-- button area-->
        <div class="btn-area">
            <button id="fnSearch" class="btn-point btn-l" type="submit">
                검색
            </button>
            <button id="fnClear" class="btn-white btn-l" type="button">
                초기화
            </button>
        </div>
        <!-- button area End -->
    </form>
</div>
<!-- Form Section end -->

<!-- 그리드 영역  -->
<div class="fb__sect">
    <div class="wrap-tit" style="width: 100%">
        <div class="ea-title">
            <h3>목록</h3>
            <span> 총<em id="pageTotalText">2</em> 건 </span>
        </div>
        <!-- item.html & itemController.js 참고 -->
        <div class="dv-grid-top-pager btn-area align-right">
            <button id="EXCEL_DN" class="ml--default dv-set-btn-type4" type="button" onclick="$scope.fnExcelExport()">
                엑셀 다운로드
            </button>
            <button id="fnSample" class="fb__btn__excel-down btn-gray" onclick="$scope.fnSample()" disabled="disabled">
                선택회원 쿠폰발급 취소
            </button>
        </div>
    </div>
    <div id="grid" class="contsection10"></div>
</div>


<script>
    //fnInitialize();	//Initialize Page Call ---------------------------------

    //Initialize PageR
    function fnInitialize() {
        $scope.$emit("fnIsMenu", { flag: true });

        fnPageInfo({
            PG_ID: "sampleList2",
            callback: null
        });
    };


    const listTemplate = function listTemplate() {
        // template elements
        const $document = $(document);
        const $form = $("#searchForm");

        const fbData = {
            //로딩
            fetches: {
                categories: false,
                search: false,
            },

            //api요청 파라미터
            requests: {
                params: null,
            },

            //데이터
            data: {
                // 달력 기본 설정 값
                seletedDateValue: 7,
            },
        };

        /************************** Functions *******************************/
        /**
         * 	유효성검사
         *  data-validator-required 필수값 여부 html 엘리먼트에 추가
         *  data-validator-reg 정규식 여부 필요한 경우 html 엘리먼트에 추가 없으면 빈 값만 체크
         */
        function validator(requestObj) {
            let result = true;
            for (let [key, value] of Object.entries(requestObj)) {
                const $target = $("[name=" + key + "]");
                let isRequired = $target.attr("data-validator-required");

                if (isRequired) {
                    if (value == "") {
                        result = false;
                    } else {
                        let isReg = $target.attr("data-validator-reg");
                        let makeReg = new RegExp(isReg, "g");

                        if (isReg && !makeReg.test(value)) {
                            result = false;
                        }
                    }
                }
            }

            return result;
        }

        // api 검색 요청
        function requestSearch(parameter) {
            fbLoading(true);
            try {
                console.log(parameter);
                //api연동
                setTimeout(function () {
                    fbLoading(false);
                }, 1000);
            } catch (ex) {
                console.log("requsetSearch has exception...", ex);
            }
        }

        //form clear 함수
        function clearForm($form) {
            if (!$form) return;

            $form.find("input,select,textarea").each(function () {
                const self = $(this);

                //textarea 태그인 경우
                if (self.is("textarea")) {
                    self.val("");
                }
                //input 태그 인 경우
                else if (self.is("input")) {
                    switch (self.attr("type")) {
                        case "text":
                        case "email":
                        case "password":
                            self.val("");
                            break;
                        case "checkbox":
                        case "radio":
                            self.prop("checked", false);
                            break;
                        default:
                            break;
                    }
                }
                //select 태그인 경우
                else if (self.is("select")) {
                    self.find("option").eq(0).prop("selected", true);
                }
                // 그 외의 경우
                else {
                    self.val("");
                }
            });
        }

        //날짜 설정 함수
        function setDate(_day) {
            //오늘 날짜
            const todayDate = new Date();

            const todayTime = todayDate.getTime();
            let startTime = "";

            if (!isNaN(_day)) {
                _day = _day * 24 * 60 * 60 * 1000;
                startTime = new Date(todayDate - _day);
                $("#startDate").val(startTime.oFormat("yyyy-MM-dd"));
                $("#endDate").val(todayDate.oFormat("yyyy-MM-dd"));
            } else {
                $("#startDate").val("");
                $("#endDate").val("");
            }
        }

        // 켄도 데이트타임피커 초기화
        function initDateTimePicker() {
            fnKendoDatePicker({
                id: 'startPickerTest',
                format: 'yyyy-MM-dd',

            });

            fnKendoDatePicker({
                id: 'endPickerTest',
                format: 'yyyy-MM-dd',
                btnStyle: true,
                btnStartId: 'startPickerTest',
                btnEndId: 'endPickerTest',
            });

            fbMakeTimePicker("#startHourPicker", "start", "hour");
            fbMakeTimePicker("#startMinPicker", "start", "min");
            fbMakeTimePicker("#endHourPicker", "end", "hour");
            fbMakeTimePicker("#endMinPicker", "end", "min");
        }

        // 켄도 데이트피커 초기화
        function initDatePicker() {
            fnKendoDatePicker({
                id: 'startDate',
                format: 'yyyy-MM-dd',

            });

            fnKendoDatePicker({
                id: 'endDate',
                format: 'yyyy-MM-dd',
                btnStyle: true,
                btnStartId: 'startDate',
                btnEndId: 'endDate',
            });
        }

        //켄도 그리드 초기화
        function initGrid() {

            var gridDs = {
                type: "odata",
                transport: {
                    read:
                        "https://demos.telerik.com/kendo-ui/service/Northwind.svc/Customers",
                },
                pageSize: 20,
            }

            function onDataBound(e) {
                //k-pager-sm, k-pager-lg 클래스가 있으면 목록 수 부분이 표출이 안되는 에러발생
                //동적으로 제거
                setTimeout(function () {
                    e.sender.element
                        .find(".k-pager-wrap")
                        .removeClass("k-pager-sm k-pager-lg");
                });
            }

            $("#grid").kendoGrid({
                dataSource: gridDs,
                height: 550,
                pageable: {
                    refresh: true,
                    pageSizes: true,
                    buttonCount: 5,
                },
                dataBound: onDataBound,
                columns: [
                    {
                        template:
                            "<div class='customer-photo'" +
                            "style='background-image: url(../content/web/Customers/#:data.CustomerID#.jpg);'></div>" +
                            "<div class='customer-name'>#: ContactName #</div>",
                        field: "ContactName",
                        title: "Contact Name",
                        width: 240,
                    },
                    {
                        field: "ContactTitle",
                        title: "Contact Title",
                    },
                    {
                        field: "CompanyName",
                        title: "Company Name",
                    },
                    {
                        field: "Country",
                        width: 150,
                    },
                ],
            });

            $(".k-pager-sizes").css("display", "flex");
        }

        //체크 박스 설정 초기화 함수
        function initCheckBoxes() {
            $(".fb__custom__checkbox").each(function () {
                $(this)
                    .find("label:first-child > input[type='checkbox']")
                    .prop("checked", true)
                    .trigger("change");
            });
        }

        /************************** 이벤트 핸들러 *******************************/

        //날짜 버튼 이벤트
        function onClickDateButton() {
            const $this = $(this);
            const $siblings = $this.siblings();
            $siblings.removeAttr("fb-btn-active");

            $this.attr("fb-btn-active", "true");

            let _day = Number($this.attr("data-id"));
        }

        //selectbox 렌더링 함수
        function renderSelectBox($el, data) {
            $el.empty();

            data.forEach(function (d) {
                const $option =
                    "<option value=" +
                    d.ilCtgryStdId +
                    ">${d.ctgryStdNm}</option>";
                $el.append($option);
            });
        }

        //검색 함수
        function onSubmit(e) {
            e.preventDefault();
            const $this = $(this);
            // const requestObj = fbSerializeForm($this);
            const requestObj = $this.formSerialize(true);
            if (requestObj) {
                requestSearch(requestObj);
            } else {
                return;
            }
        }

        //체크박스 공통 이벤트
        function onChangeCheckbox(e) {
            const $target = $(e.target);
            const $this = $(this);
            const $label = $target.parent();

            const _isCheckAllBtn = !!$target.attr("data-check");
            const _isChecked = $target.is(":checked");

            //전체 선택인 경우
            if (_isCheckAllBtn) {
                $label.siblings().each(function () {
                    $(this).find("input").prop("checked", _isChecked);
                });
            }
            //전체 선택 아닌 경우
            else {
                const maxLength = $this.find("input").not("[data-check]")
                    .length;
                const $checkAllBtn = $this.find("[data-check]");

                if (!_isChecked) $checkAllBtn.prop("checked", false);
                else {
                    const checkedLength = $this.find(
                        "input[type='checkbox']:checked"
                    ).length;
                    const _isCheckedAll = checkedLength === maxLength;
                    if (_isCheckedAll) {
                        $checkAllBtn
                            .prop("checked", _isCheckedAll)
                            .trigger("change");
                    }
                }
            }
        }

        //clear 버튼 클릭 함수
        function onClear() {
            clearForm($form);
            initCheckBoxes();
        }

        function bindEvents() {
            $("#searchForm").on("submit", onSubmit);

            //체크 박스 공통 이벤트
            $document.on("change", ".fb__custom__checkbox", onChangeCheckbox);

            //초기화 버튼 이벤트 바인딩
            $("#fnClear").on("click", onClear);
        }

        /*****************************************************************/

        //초기화 함수
        function init() {
            //체크박스 초기화
            // initCheckBoxes();

            bindEvents();
            initDatePicker();
            initDateTimePicker();
            initGrid();
        }

        init();
    };

    listTemplate();
</script>