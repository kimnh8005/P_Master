<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.pulmuone.v1.comm.mapper.goods.stock.GoodsStockListMapper">

  <resultMap type="kr.co.pulmuone.v1.goods.stock.dto.vo.StockListResultVo" id="stockListMap">
    <result column="IL_ITEM_WAREHOUSE_ID" property="ilItemWarehouseId" />
    <result column="BASE_DT"  property="baseDt" />
    <result column="D0_STOCK_QUANTITY" property="d0stockQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D1_STOCK_QUANTITY" property="d1stockQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D2_STOCK_QUANTITY" property="d2stockQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D3_STOCK_QUANTITY" property="d3stockQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D4_STOCK_QUANTITY" property="d4stockQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D5_STOCK_QUANTITY" property="d5stockQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D6_STOCK_QUANTITY" property="d6stockQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D7_STOCK_QUANTITY" property="d7stockQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D8_STOCK_QUANTITY" property="d8stockQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D9_STOCK_QUANTITY" property="d9stockQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D10_STOCK_QUANTITY" property="d10stockQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D0_ORDER_QUANTITY" property="d0orderQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D1_ORDER_QUANTITY" property="d1orderQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D2_ORDER_QUANTITY" property="d2orderQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D3_ORDER_QUANTITY" property="d3orderQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D4_ORDER_QUANTITY" property="d4orderQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D5_ORDER_QUANTITY" property="d5orderQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D6_ORDER_QUANTITY" property="d6orderQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D7_ORDER_QUANTITY" property="d7orderQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D8_ORDER_QUANTITY" property="d8orderQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D9_ORDER_QUANTITY" property="d9orderQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D10_ORDER_QUANTITY" property="d10orderQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D11_ORDER_QUANTITY" property="d11orderQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D12_ORDER_QUANTITY" property="d12orderQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D13_ORDER_QUANTITY" property="d13orderQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D14_ORDER_QUANTITY" property="d14orderQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D15_ORDER_QUANTITY" property="d15orderQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D0_ORDER_QUANTITY" property="d0orderQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D1_QUANTITY" property="d1Quantity" javaType="long" jdbcType="INTEGER" />
    <result column="D2_QUANTITY" property="d2Quantity" javaType="long" jdbcType="INTEGER" />
    <result column="D3_QUANTITY" property="d3Quantity" javaType="long" jdbcType="INTEGER" />
    <result column="D4_QUANTITY" property="d4Quantity" javaType="long" jdbcType="INTEGER" />
    <result column="D5_QUANTITY" property="d5Quantity" javaType="long" jdbcType="INTEGER" />
    <result column="D6_QUANTITY" property="d6Quantity" javaType="long" jdbcType="INTEGER" />
    <result column="D7_QUANTITY" property="d7Quantity" javaType="long" jdbcType="INTEGER" />
    <result column="D8_QUANTITY" property="d8Quantity" javaType="long" jdbcType="INTEGER" />
    <result column="D9_QUANTITY" property="d9Quantity" javaType="long" jdbcType="INTEGER" />
    <result column="D10_QUANTITY" property="d10Quantity" javaType="long" jdbcType="INTEGER" />
    <result column="D11_QUANTITY" property="d11Quantity" javaType="long" jdbcType="INTEGER" />
    <result column="D12_QUANTITY" property="d12Quantity" javaType="long" jdbcType="INTEGER" />
    <result column="D13_QUANTITY" property="d13Quantity" javaType="long" jdbcType="INTEGER" />
    <result column="D14_QUANTITY" property="d14Quantity" javaType="long" jdbcType="INTEGER" />
    <result column="D15_QUANTITY" property="d15Quantity" javaType="long" jdbcType="INTEGER" />
    <result column="CREATE_ID" property="createId" />
    <result column="CREATE_DATE" property="createDate" />
    <result column="MODIFY_ID" property="modifyId" />
    <result column="MODIFY_DATE" property="modifyDate" />
    <result column="IL_ITEM_CODE" property="ilItemCode" />
    <result column="UR_SUPPLIER_WAREHOUSE_ID" property="urSupplierWarehouseId" />
    <result column="UNLIMIT_STOCK_YN" property="unlimitStockYn" typeHandler="kr.co.pulmuone.v1.comm.base.mybatis.hanlder.BooleanTypeHandler" />
    <result column="STOCK_PO_YN" property="stockPoYn" typeHandler="kr.co.pulmuone.v1.comm.base.mybatis.hanlder.BooleanTypeHandler" />
    <result column="PRE_ORDER_YN" property="preOrderYn" />
    <result column="PRE_ORDER_TYPE" property="preOrderType" />
    <result column="DEFAULT_PRE_ORDER_TYPE" property="defaultPreOrderType" />
    <result column="PRE_ORDER_NM" property="preOrderNm" />
    <result column="MEMO" property="memo" />
    <result column="DISTRIBUTION_PERIOD" property="distributionPeriod" />
    <result column="GOODS_TP" property="goodsTp" />
    <result column="IL_ITEM_CD" property="ilItemCd" />
    <result column="BARCODE" property="barcode" />
    <result column="ITEM_NM" property="itemNm" />
    <result column="IL_GOODS_ID" property="ilGoodsId" />
    <result column="GOODS_TP_NM" property="goodsTpNm" />
    <result column="SALE_STATUS_NM" property="saleStatusNm" />
    <result column="WAREHOUSE_NM" property="warehouseNm" />
    <result column="SUPPLIER_NM" property="supplierNm" />
    <result column="UR_SUPPLIER_ID" property="urSupplierId" />
    <result column="PRE_ORDER_YN" property="preOrderYn" />
    <result column="STORAGE_METHOD_TP_NM" property="storageMethodTpNm" />
    <result column="STOCK_CLOSING_COUNT" property="stockClosingCount" />
    <result column="STOCK_CONFIRMED_COUNT" property="stockConfirmedCount" />
    <result column="STOCK_SCHEDULED_COUNT" property="stockScheduledCount" />
    <result column="WMS_COUNT" property="wmsCount" />
    <result column="CTGRY_STD_NM" property="ctgryStdNm" />
    <result column="STOCK_TP" property="stockTp" />
    <result column="STOCK_NM" property="stockNm" />
    <result column="STOCK_QTY" property="stockQty" />
    <result column="STOCK_SCHEDULED_COUNT" property="stockScheduledCount" />
    <result column="REST_DISTRIBUTION_PERIOD" property="restDistributionPeriod" />
    <result column="REST_DISTRIBUTION_DDAY" property="restDistributionDday" />
    <result column="ERP_CTGRY_LV1_ID" property="erpCtgryLv1Id" />
    <result column="ERP_LINK_IF_YN" property="erpLinkIfYn" />
    <result column="ITEM_TP" property="itemTp" />
    <result column="GOODS_TP" property="goodsTp" />
    <result column="NAME" property="name" />
    <result column="IL_STOCK_DEADLINE_ID" property="ilStockDeadlineId" />
    <result column="SUPPLIER_CD" property="supplierCd" />
	<result column="D0_STOCK_CLOSED_ADJ_QTY" property="d0StockClosedAdjQty" />
	<result column="D0_STOCK_SCHEDULED_ADJ_QTY" property="d0StockScheduledAdjQty" />
	<result column="D0_STOCK_CONFIRMED_ADJ_QTY" property="d0StockConfirmedAdjQty" />
  </resultMap>

  <!--───────────────────────────────────────────────────────────────────────
   * description : 품목별 재고리스트 조회
   * @
   * @ 수정일                   수정자   수정내용
   * @ ──────────────────────────────────────────────────────────────────────
   * @ 2020.11.05  이성준   최초생성
   * @
  ────────────────────────────────────────────────────────────────────────-->
  <select id="getStockList" resultMap="stockListMap">
    /* stockList.getStockList */
		SELECT
			TOTAL.*
			, IFNULL(DIC_GOODS_TYPE.DIC_MST_NM,'') AS GOODS_TP_NM /* 상품유형명 */
			, IFNULL(DIC_SALE_STATUS.DIC_MST_NM, '') AS SALE_STATUS_NM /* 판매상태 */
			, IFNULL(DIC_ERP_STORAGE_TYPE.DIC_MST_NM, '') AS STORAGE_METHOD_TP_NM /* 보관방법 */
			, UCS.COMP_NM AS SUPPLIER_NM /* 공급처 */
			, IFNULL((SELECT CTGRY_STD_NM FROM IL_CTGRY_STD WHERE IL_CTGRY_STD_ID = ICSPI.CTGRY_STD_ID_DEPTH1), '') AS CTGRY_STD_NM /* 표준카테고리(대) */
			, CASE
				WHEN TOTAL.PRE_ORDER_YN = 'N' THEN '한정재고'
				WHEN TOTAL.PRE_ORDER_YN = 'Y' AND TOTAL.PRE_ORDER_TYPE = 'PRE_ORDER_TP.NOT_ALLOWED' THEN '한정재고'
				WHEN TOTAL.PRE_ORDER_YN = 'Y' AND TOTAL.PRE_ORDER_TYPE IN ('PRE_ORDER_TP.LIMITED_ALLOWED', 'PRE_ORDER_TP.UNLIMITED_ALLOWED') THEN
					CASE
						WHEN TOTAL.SUPPLIER_CD = 'PF' THEN '선주문(식품)'
						WHEN TOTAL.SUPPLIER_CD = 'OG' AND TOTAL.ERP_CTGRY_LV1_ID = '과일' AND IPT.ERP_PO_TP = 'ERP_PO_TP.R1' THEN '선주문(과일)'
						WHEN TOTAL.SUPPLIER_CD = 'OG' AND TOTAL.ERP_CTGRY_LV1_ID NOT IN ('과일', '채소', '') AND IPT.ERP_PO_TP = 'ERP_PO_TP.R1' THEN '선주문(가공)'
					END
			END AS PRE_ORDER_NM /* 재고운영형태 */
			, CASE
				WHEN TOTAL.GOODS_TP = 'GOODS_TYPE.DISPOSAL' THEN IFNULL(TOTAL.D0_STOCK_DISCARD_QTY, 0)
				ELSE (
					CAST(
						IFNULL((
							SELECT
								IIESH.STOCK_QTY
							FROM
								IL_ITEM_ERP_STOCK_HISTORY IIESH
							WHERE
								IIESH.STOCK_TP = 'ERP_STOCK_TP.CLOSED'
								AND IIESH.IL_ITEM_WAREHOUSE_ID = TOTAL.IL_ITEM_WAREHOUSE_ID
								AND IIESH.BASE_DT = TOTAL.BASE_DT
							ORDER BY IIESH.CREATE_DT DESC
							LIMIT 1
						), 0) AS SIGNED
					)
				)
			END AS STOCK_CLOSING_COUNT /* 전일마감재고 */
			, IFNULL((
				SELECT
					IIESH.STOCK_QTY
				FROM
					IL_ITEM_ERP_STOCK_HISTORY IIESH
				WHERE
					IIESH.STOCK_TP = 'ERP_STOCK_TP.CONFIRMED'
					AND IIESH.IL_ITEM_WAREHOUSE_ID = TOTAL.IL_ITEM_WAREHOUSE_ID
					AND IIESH.BASE_DT = TOTAL.BASE_DT
				ORDER BY IIESH.CREATE_DT DESC
				LIMIT 1
			), 0) AS STOCK_CONFIRMED_COUNT /* 입고확정량 */
			, IFNULL((
				SELECT
					SUM(IIESH.STOCK_QTY)
				FROM
					IL_ITEM_ERP_STOCK_HISTORY IIESH
				WHERE
					IIESH.STOCK_TP = 'ERP_STOCK_TP.SCHEDULED'
					AND IIESH.IL_ITEM_WAREHOUSE_ID = TOTAL.IL_ITEM_WAREHOUSE_ID
					AND IIESH.SCHEDULE_DT = TOTAL.BASE_DT
			), 0) AS STOCK_SCHEDULED_COUNT /* 입고예정량고 */
			, IFNULL((
				SELECT
					IIESH.STOCK_QTY
				FROM
					IL_ITEM_ERP_STOCK_HISTORY IIESH
				WHERE
					IIESH.STOCK_TP = 'ERP_STOCK_TP.OFFLINE'
					AND IIESH.IL_ITEM_WAREHOUSE_ID = TOTAL.IL_ITEM_WAREHOUSE_ID
					AND IIESH.BASE_DT = TOTAL.BASE_DT
				ORDER BY IIESH.CREATE_DT DESC
				LIMIT 1
			), 0) AS WMS_COUNT /* 오프라인물류재고량 */
			, IFNULL((
					SELECT STOCK_QTY
					  FROM IL_ITEM_ERP_STOCK_HISTORY
					 WHERE BASE_DT = #{baseDt}
					   AND IL_ITEM_WAREHOUSE_ID = TOTAL.IL_ITEM_WAREHOUSE_ID
					   AND STOCK_TP = 'ERP_STOCK_TP.CLOSED_ADJ'
					 ORDER BY CREATE_DT DESC
					 LIMIT 1
			         ), 0) AS D0_STOCK_CLOSED_ADJ_QTY
			, IFNULL((
					SELECT STOCK_QTY
					  FROM IL_ITEM_ERP_STOCK_HISTORY
					 WHERE BASE_DT = #{baseDt}
					   AND IL_ITEM_WAREHOUSE_ID = TOTAL.IL_ITEM_WAREHOUSE_ID
					   AND STOCK_TP = 'ERP_STOCK_TP.SCHEDULED_ADJ'
					 ORDER BY CREATE_DT DESC
					 LIMIT 1
			         ), 0) AS D0_STOCK_SCHEDULED_ADJ_QTY
			, IFNULL((
					SELECT STOCK_QTY
					  FROM IL_ITEM_ERP_STOCK_HISTORY
					 WHERE BASE_DT = #{baseDt}
					   AND IL_ITEM_WAREHOUSE_ID = TOTAL.IL_ITEM_WAREHOUSE_ID
					   AND STOCK_TP = 'ERP_STOCK_TP.CONFIRMED_ADJ'
					 ORDER BY CREATE_DT DESC
					 LIMIT 1
			         ), 0) AS D0_STOCK_CONFIRMED_ADJ_QTY
		FROM (
			SELECT
				T.IL_ITEM_STOCK_ID /* 품목재고SEQ */
				, T.SORT /* 가중치 정렬순서 */
				, T.BASE_DT /* 기준일 */
				, T.IL_ITEM_WAREHOUSE_ID /* 품목별 출고처 관리ID */
				, T.IL_ITEM_CD /* 품목코드 */
				, T.BARCODE /* 바코드 */
				, T.ITEM_NM /* 품목명 */
				, T.ERP_CTGRY_LV1_ID /* 카테고리 */
				, T.ERP_LINK_IF_YN /* ERP 연동여부*/
				, T.ITEM_TP /* 마스터 품목유형*/
				, T.IL_GOODS_ID /* 상품코드 */
				, T.GOODS_TP /* 상품유형 */
				, T.SALE_STATUS /* 판매상태 */
				, T.WAREHOUSE_NM /* 출고처 */
				, T.UR_WAREHOUSE_ID /* 출고처ID */
				, T.UR_SUPPLIER_ID /* 공급처ID */
				, T.PRE_ORDER_YN /* 재고운영형태(선주문여부) */
				, T.STORAGE_METHOD_TP /* 보관방법 */
				, T.SUPPLIER_CD /* 공급업체CODE */
				, T.PRE_ORDER_TYPE /* 선주문 유형 */
				, T.D0_STOCK_DISCARD_QTY
				, T.IL_CTGRY_STD_ID
				, T.IL_PO_TP_ID
				, T.S_COMPANY_ID
			FROM (
				SELECT
					A.IL_ITEM_STOCK_ID /* 품목재고SEQ */
					, A.BASE_DT /* 기준일 */
					, B.IL_ITEM_WAREHOUSE_ID /* 품목별 출고처 관리ID */
					, C.IL_ITEM_CD /* 품목코드 */
					, C.ITEM_BARCODE /* 품목바코드 */
					, C.ITEM_NM /* 품목명 */
					, C.ERP_CTGRY_LV1_ID /* 카테고리 */
					, C.ERP_IF_YN AS ERP_LINK_IF_YN /* ERP 연동여부 */
					, C.ITEM_BARCODE AS BARCODE
					, C.ITEM_TP /* 마스터 품목유형 */
					, IFNULL(I.IL_GOODS_ID, '') AS IL_GOODS_ID /* 상품코드 */
					, IFNULL(I.GOODS_TP, '') AS GOODS_TP /* 상품유형 */
					, IFNULL(I.SORT, 4) AS SORT /* 가중치 정렬순서 */
					, IFNULL(I.SALE_STATUS, '') AS SALE_STATUS /* 판매상태 */
					, F.WAREHOUSE_NM /* 출고처 */
					, F.UR_WAREHOUSE_ID /* 출고처ID */
					, D.UR_SUPPLIER_ID /* 공급처ID */
					, B.PRE_ORDER_YN /* 선주문 가능 여부 */
					, C.STORAGE_METHOD_TP /* 보관방법 */
					, A.D0_STOCK_DISCARD_QTY /* 폐기예정수량 */
					, E.SUPPLIER_CD /* 공급업체CODE */
					, B.PRE_ORDER_TP AS PRE_ORDER_TYPE /* 선주문 유형 */
					, C.IL_CTGRY_STD_ID AS IL_CTGRY_STD_ID /* 표준카테고리 ID */
					, B.IL_PO_TP_ID AS IL_PO_TP_ID
					, E.UR_COMPANY_ID AS S_COMPANY_ID
				FROM
					IL_ITEM_STOCK_HISTORY A
					INNER JOIN IL_ITEM_WAREHOUSE B
						ON B.IL_ITEM_WAREHOUSE_ID = A.IL_ITEM_WAREHOUSE_ID
					INNER JOIN  IL_ITEM C
						ON C.IL_ITEM_CD = B.IL_ITEM_CD
					INNER JOIN  UR_SUPPLIER_WAREHOUSE D
						ON D.UR_SUPPLIER_WAREHOUSE_ID = B.UR_SUPPLIER_WAREHOUSE_ID
					INNER JOIN UR_SUPPLIER E
						ON E.UR_SUPPLIER_ID = D.UR_SUPPLIER_ID
					INNER JOIN UR_WAREHOUSE F
						ON F.UR_WAREHOUSE_ID = D.UR_WAREHOUSE_ID
						AND F.STOCK_ORDER_YN = 'Y'
					LEFT JOIN (
						SELECT
							I.*
						FROM (
							SELECT
								IL_GOODS_ID
								, UR_WAREHOUSE_ID
								, IL_ITEM_CD
								, SALE_STATUS
								, GOODS_TP
								, CASE
									WHEN GOODS_TP = 'GOODS_TYPE.NORMAL' THEN 1
									WHEN GOODS_TP = 'GOODS_TYPE.GIFT' THEN 2
									WHEN GOODS_TP = 'GOODS_TYPE.ADDITIONAL' THEN 3
									WHEN GOODS_TP = 'GOODS_TYPE.DAILY' THEN 4
									WHEN GOODS_TP = 'GOODS_TYPE.INCORPOREITY' THEN 5
	  								WHEN GOODS_TP = 'GOODS_TYPE.GIFT_FOOD_MARKETING' THEN 6
									ELSE 7
								END AS SORT
							FROM
								IL_GOODS
							WHERE
								DEL_YN = 'N'
								AND GOODS_TP IN ('GOODS_TYPE.NORMAL', 'GOODS_TYPE.GIFT', 'GOODS_TYPE.ADDITIONAL', 'GOODS_TYPE.DAILY', 'GOODS_TYPE.INCORPOREITY', 'GOODS_TYPE.GIFT_FOOD_MARKETING') /* 일반, 증정, 추가, 일일, 무형  */
							ORDER BY SORT
							LIMIT 999999999999999999
						)I
						GROUP BY I.IL_ITEM_CD, I.UR_WAREHOUSE_ID
					) I
						ON I.UR_WAREHOUSE_ID = D.UR_WAREHOUSE_ID
						AND I.IL_ITEM_CD = C.IL_ITEM_CD
				<where>
					<if test="@kr.co.pulmuone.v1.comm.util.StringUtil@isEquals(selectConditionType, 'codeSearch')">
						<if test="@kr.co.pulmuone.v1.comm.util.StringUtil@isNotEmpty(itemCodes)">
							AND (
								C.IL_ITEM_CD IN
								<foreach item="data" index="index" collection="ilItemCodeArray" open="(" separator="," close=")">
									#{data}
								</foreach>
								OR
								C.ITEM_BARCODE IN
								<foreach item="data" index="index" collection="ilItemCodeArray" open="(" separator="," close=")">
									#{data}
								</foreach>
							)
						</if>
						<if test="@kr.co.pulmuone.v1.comm.util.StringUtil@isNotEmpty(baseDt)">
							AND A.BASE_DT = #{baseDt}
						</if>
					</if>

					<if test="@kr.co.pulmuone.v1.comm.util.StringUtil@isEquals(selectConditionType, 'condSearch')">
						<if test="@kr.co.pulmuone.v1.comm.util.StringUtil@isNotEmpty(subBaseDt)">
							AND A.BASE_DT = #{subBaseDt} /* 기준일 */
						</if>
						<if test="saleStatusList !=null &amp;&amp; saleStatusList.size() > 0"> <!-- 판매상태 -->
							AND I.SALE_STATUS IN
							<foreach collection="saleStatusList" item="saleStatus" index="index" separator="," open="(" close=")">
								#{saleStatus}
							</foreach>
						</if>
						<choose>
							<when test="@kr.co.pulmuone.v1.comm.util.StringUtil@isEquals(isNoGoodsItem, 'Y')">
								AND (
									I.IL_GOODS_ID IS NULL
									<if test="goodsTypeList !=null &amp;&amp; goodsTypeList.size() > 0"> <!-- 상품유형 -->
										OR I.GOODS_TP IN
										<foreach collection="goodsTypeList" item="goodsType" index="index" separator="," open="(" close=")">
											#{goodsType}
										</foreach>
									</if>
								)
							</when>
							<otherwise>
								<if test="goodsTypeList !=null &amp;&amp; goodsTypeList.size() > 0"> <!-- 상품유형 -->
									AND I.GOODS_TP IN
									<foreach collection="goodsTypeList" item="goodsType" index="index" separator="," open="(" close=")">
										#{goodsType}
									</foreach>
								</if>
							</otherwise>
						</choose>
						<if test="storageMethodTypeList !=null &amp;&amp; storageMethodTypeList.size() > 0"> <!-- 보관방법 -->
							AND C.STORAGE_METHOD_TP IN
							<foreach collection="storageMethodTypeList" item="keepMethod" index="index" separator="," open="(" close=")">
								#{keepMethod}
							</foreach>
						</if>
						<if test="@kr.co.pulmuone.v1.comm.util.StringUtil@isNotEmpty(stockOperType)">
							<choose>
								<when test="@kr.co.pulmuone.v1.comm.util.StringUtil@isEquals(stockOperType, 'Y')">
									 AND B.PRE_ORDER_YN = 'Y' /* 선주문 가능 여부 */
									 AND B.PRE_ORDER_TP IN ('PRE_ORDER_TP.LIMITED_ALLOWED', 'PRE_ORDER_TP.UNLIMITED_ALLOWED') /* 선주문 유형 */
								</when>
								<when test="@kr.co.pulmuone.v1.comm.util.StringUtil@isEquals(stockOperType, 'N')">
									AND (
										B.PRE_ORDER_YN = 'N' /* 선주문 가능 여부 */
										OR (
											B.PRE_ORDER_YN = 'Y'
											AND B.PRE_ORDER_TP = 'PRE_ORDER_TP.NOT_ALLOWED' /* 선주문 유형 */
										)
									)
								</when>
								<otherwise>
									AND B.PRE_ORDER_YN = #{stockOperType} /* 선주문 가능 여부 */
								</otherwise>
							</choose>
						</if>
						<if test="@kr.co.pulmuone.v1.comm.util.StringUtil@isNotEmpty(bigCategory)">
							AND (SELECT CTGRY_STD_ID_DEPTH1 FROM IL_CTGRY_STD_PRNTS_INFO WHERE IL_CTGRY_STD_ID = C.IL_CTGRY_STD_ID) = #{bigCategory} /* 표준카테고리(대분류) */
						</if>
						<if test="@kr.co.pulmuone.v1.comm.util.StringUtil@isNotEmpty(urSupplierId)">
							AND D.UR_SUPPLIER_ID = #{urSupplierId} /* 공급업체 */
						</if>
						<if test="@kr.co.pulmuone.v1.comm.util.StringUtil@isNotEmpty(urWarehouseId)">
							AND D.UR_WAREHOUSE_ID = #{urWarehouseId} /* 출고처 */
						</if>
						<if test="@kr.co.pulmuone.v1.comm.util.StringUtil@isNotEmpty(itemName)">
							AND C.ITEM_NM LIKE CONCAT('%', #{itemName}, '%') /* 품목명 */
						</if>
					</if>

					<if test="selectConditionType == null">
					AND A.BASE_DT = CURDATE()
					</if>
					<if test="@kr.co.pulmuone.v1.comm.util.StringUtil@isNotEmpty(listAuthSupplierId) and listAuthSupplierId.size != 0">
						AND E.UR_SUPPLIER_ID IN
						<foreach item="data" index="index" collection="listAuthSupplierId" open="(" separator="," close=")">
		                  		#{data}
		 	            		</foreach>
					</if>
					<if test="@kr.co.pulmuone.v1.comm.util.StringUtil@isNotEmpty(listAuthWarehouseId) and listAuthWarehouseId.size != 0">
						AND F.UR_WAREHOUSE_ID IN
						<foreach item="data" index="index" collection="listAuthWarehouseId" open="(" separator="," close=")">
		              		#{data}
		          		</foreach>
					</if>
				</where>
				ORDER BY
					SORT
			) T
			GROUP BY
				T.IL_ITEM_STOCK_ID
		) TOTAL
		INNER JOIN UR_COMPANY UCS
			ON UCS.UR_COMPANY_ID = TOTAL.S_COMPANY_ID
		INNER JOIN IL_CTGRY_STD_PRNTS_INFO ICSPI
			ON ICSPI.IL_CTGRY_STD_ID = TOTAL.IL_CTGRY_STD_ID
		LEFT JOIN IL_PO_TP IPT
			ON IPT.IL_PO_TP_ID = TOTAL.IL_PO_TP_ID
		LEFT JOIN (
			SELECT
				SCC.ST_COMN_CODE_ID
				, GDM.DIC_MST_NM
			FROM ST_COMN_CODE SCC
				INNER JOIN GB_DIC_MST GDM
					ON GDM.GB_DIC_MST_ID = SCC.GB_DIC_MST_ID
			WHERE
				SCC.ST_COMN_CODE_MST_CD = 'GOODS_TYPE'
		) DIC_GOODS_TYPE
			ON DIC_GOODS_TYPE.ST_COMN_CODE_ID = TOTAL.GOODS_TP
		LEFT JOIN (
			SELECT
				SCC.ST_COMN_CODE_ID
				, GDM.DIC_MST_NM
			FROM ST_COMN_CODE SCC
				INNER JOIN GB_DIC_MST GDM
					ON GDM.GB_DIC_MST_ID = SCC.GB_DIC_MST_ID
			WHERE
				SCC.ST_COMN_CODE_MST_CD = 'SALE_STATUS'
		) DIC_SALE_STATUS
			ON DIC_SALE_STATUS.ST_COMN_CODE_ID = TOTAL.SALE_STATUS
		LEFT JOIN (
			SELECT
				SCC.ST_COMN_CODE_ID
				, GDM.DIC_MST_NM
			FROM ST_COMN_CODE SCC
				INNER JOIN GB_DIC_MST GDM
					ON GDM.GB_DIC_MST_ID = SCC.GB_DIC_MST_ID
			WHERE
				SCC.ST_COMN_CODE_MST_CD = 'ERP_STORAGE_TYPE'
		) DIC_ERP_STORAGE_TYPE
			ON DIC_ERP_STORAGE_TYPE.ST_COMN_CODE_ID = TOTAL.STORAGE_METHOD_TP
		ORDER BY
			TOTAL.IL_ITEM_STOCK_ID, TOTAL.SORT
  </select>


  <resultMap type="kr.co.pulmuone.v1.goods.stock.dto.vo.StockListResultVo" id="stockInfoMap">
    <result column="IL_ITEM_WAREHOUSE_ID" property="ilItemWarehouseId" />
    <result column="BASE_DT"  property="baseDt" />
    <result column="ITEM_NM"  property="itemNm" />
    <result column="BARCODE"  property="barcode" />
    <result column="D0_STOCK_QUANTITY" property="d0stockQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D1_STOCK_QUANTITY" property="d1stockQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D2_STOCK_QUANTITY" property="d2stockQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D3_STOCK_QUANTITY" property="d3stockQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D4_STOCK_QUANTITY" property="d4stockQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D5_STOCK_QUANTITY" property="d5stockQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D6_STOCK_QUANTITY" property="d6stockQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D7_STOCK_QUANTITY" property="d7stockQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D8_STOCK_QUANTITY" property="d8stockQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D9_STOCK_QUANTITY" property="d9stockQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D10_STOCK_QUANTITY" property="d10stockQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D11_STOCK_QUANTITY" property="d11stockQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D12_STOCK_QUANTITY" property="d12stockQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D13_STOCK_QUANTITY" property="d13stockQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D14_STOCK_QUANTITY" property="d14stockQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D15_STOCK_QUANTITY" property="d15stockQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D0_STOCK_DISCARD_QTY" property="d0stockDiscardQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D0_ORDER_QUANTITY" property="d0orderQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D1_ORDER_QUANTITY" property="d1orderQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D2_ORDER_QUANTITY" property="d2orderQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D3_ORDER_QUANTITY" property="d3orderQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D4_ORDER_QUANTITY" property="d4orderQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D5_ORDER_QUANTITY" property="d5orderQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D6_ORDER_QUANTITY" property="d6orderQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D7_ORDER_QUANTITY" property="d7orderQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D8_ORDER_QUANTITY" property="d8orderQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D9_ORDER_QUANTITY" property="d9orderQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D10_ORDER_QUANTITY" property="d10orderQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D11_ORDER_QUANTITY" property="d11orderQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D12_ORDER_QUANTITY" property="d12orderQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D13_ORDER_QUANTITY" property="d13orderQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D14_ORDER_QUANTITY" property="d14orderQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D15_ORDER_QUANTITY" property="d15orderQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D0_ORDER_DISCARD_QTY" property="d0orderDiscardQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="CREATE_ID" property="createId" />
    <result column="CREATE_DATE" property="createDate" />
    <result column="MODIFY_ID" property="modifyId" />
    <result column="MODIFY_DATE" property="modifyDate" />
    <result column="IL_ITEM_CODE" property="ilItemCode" />
    <result column="UR_SUPPLIER_WAREHOUSE_ID" property="urSupplierWarehouseId" />
    <result column="UNLIMIT_STOCK_YN" property="unlimitStockYn" typeHandler="kr.co.pulmuone.v1.comm.base.mybatis.hanlder.BooleanTypeHandler" />
    <result column="STOCK_PO_YN" property="stockPoYn" typeHandler="kr.co.pulmuone.v1.comm.base.mybatis.hanlder.BooleanTypeHandler" />
    <result column="PRE_ORDER_YN" property="preOrderYn" />
    <result column="PRE_ORDER_TYPE" property="preOrderType" />
    <result column="MEMO" property="memo" />
    <result column="DISTRIBUTION_PERIOD" property="distributionPeriod" />
    <result column="IL_ITEM_CD" property="ilItemCd" />
    <result column="SUPPLIER_NM" property="supplierNm" />
    <result column="UR_SUPPLIER_ID" property="urSupplierId" />
    <result column="PRE_ORDER_YN" property="preOrderYn" />
    <result column="PRE_ORDER_NM" property="preOrderNm" />
    <result column="STOCK_SCHEDULED_COUNT" property="stockScheduledCount" />
    <result column="NAME" property="name" />
    <result column="IL_STOCK_DEADLINE_ID" property="ilStockDeadlineId" />
    <result column="WAREHOUSE_NM" property="warehouseNm" />
    <result column="GOODS_DISPOSAL_CNT" property="goodsDisposalCnt" />
    <result column="D0_STOCK_CLOSED_QTY" property="d0StockClosedQty" />
    <result column="D0_STOCK_CONFIRMED_QTY" property="d0StockConfirmedQty" />
    <result column="D0_STOCK_CLOSED_ADJ_QTY" property="d0StockClosedAdjQty" />
    <result column="D0_STOCK_SCHEDULED_ADJ_QTY" property="d0StockScheduledAdjQty" />
    <result column="D0_STOCK_CONFIRMED_ADJ_QTY" property="d0StockConfirmedAdjQty" />
    <collection column="{baseDt = BASE_DT, ilItemWarehouseId = IL_ITEM_WAREHOUSE_ID}"  property="orderQtyList" javaType="java.util.ArrayList"
													ofType="kr.co.pulmuone.v1.goods.stock.dto.vo.StockListResultVo" select="getStockOrderQty"/>
	<collection column="{baseDt = BASE_DT, ilItemWarehouseId = IL_ITEM_WAREHOUSE_ID}"  property="stockQtyList" javaType="java.util.ArrayList"
													ofType="kr.co.pulmuone.v1.goods.stock.dto.vo.StockListResultVo" select="getStockDetailSum"/>
  </resultMap>

  <!--───────────────────────────────────────────────────────────────────────
   * description : 재고 상세정보 조회
   * @
   * @ 수정일                   수정자   수정내용
   * @ ──────────────────────────────────────────────────────────────────────
   * @ 2020.12.03  이성준   최초생성
   * @
  ────────────────────────────────────────────────────────────────────────-->
  <select id="getStockInfo" resultMap="stockInfoMap">
    /* stockList.getStockInfo */
	SELECT
		A.IL_ITEM_WAREHOUSE_ID              AS  IL_ITEM_WAREHOUSE_ID
		, DATE_FORMAT( A.BASE_DT, '%Y%m%d' )  AS  BASE_DT
		, D.ITEM_NM                           AS ITEM_NM
		, D.ITEM_BARCODE AS BARCODE
		, CASE
			WHEN B.PRE_ORDER_YN = 'N' THEN '한정재고'
			WHEN B.PRE_ORDER_YN = 'Y' THEN (
				CASE
					WHEN B.PRE_ORDER_TP = 'PRE_ORDER_TP.NOT_ALLOWED' THEN '선주문(한정재고)'
					WHEN B.PRE_ORDER_TP IN ('PRE_ORDER_TP.LIMITED_ALLOWED', 'PRE_ORDER_TP.UNLIMITED_ALLOWED') THEN (
						CASE
							WHEN F.SUPPLIER_CD = 'PF' THEN '선주문(식품)'
							WHEN F.SUPPLIER_CD = 'OG' AND IPT.ERP_PO_TP = 'ERP_PO_TP.R1' AND D.ERP_CTGRY_LV1_ID = '과일' THEN '선주문(과일)'
							WHEN F.SUPPLIER_CD = 'OG' AND IPT.ERP_PO_TP = 'ERP_PO_TP.R1' AND D.ERP_CTGRY_LV1_ID IS NOT NULL AND D.ERP_CTGRY_LV1_ID NOT IN ('과일', '채소', '') THEN '선주문(가공)'
							ELSE '선주문(미정)'
						END
					)
					ELSE '선주문'
				END
			)
			ELSE '재고연동'
		END AS PRE_ORDER_NM	/* 재고운영형태 */
      , A.D0_STOCK_QTY                      AS  D0_STOCK_QUANTITY
      , A.D1_STOCK_QTY                      AS  D1_STOCK_QUANTITY
      , A.D2_STOCK_QTY                      AS  D2_STOCK_QUANTITY
      , A.D3_STOCK_QTY                      AS  D3_STOCK_QUANTITY
      , A.D4_STOCK_QTY                      AS  D4_STOCK_QUANTITY
      , A.D5_STOCK_QTY                      AS  D5_STOCK_QUANTITY
      , A.D6_STOCK_QTY                      AS  D6_STOCK_QUANTITY
      , A.D7_STOCK_QTY                      AS  D7_STOCK_QUANTITY
      , A.D8_STOCK_QTY                      AS  D8_STOCK_QUANTITY
      , A.D9_STOCK_QTY                      AS  D9_STOCK_QUANTITY
      , A.D10_STOCK_QTY                     AS  D10_STOCK_QUANTITY
      , A.D11_STOCK_QTY                     AS  D11_STOCK_QUANTITY
      , A.D12_STOCK_QTY                     AS  D12_STOCK_QUANTITY
      , A.D13_STOCK_QTY                     AS  D13_STOCK_QUANTITY
      , A.D14_STOCK_QTY                     AS  D14_STOCK_QUANTITY
      , A.D15_STOCK_QTY                     AS  D15_STOCK_QUANTITY
      , A.D0_STOCK_DISCARD_QTY              AS  D0_STOCK_DISCARD_QTY
      , A.D0_ORDER_QTY                      AS  D0_ORDER_QUANTITY
      , A.D1_ORDER_QTY                      AS  D1_ORDER_QUANTITY
      , A.D2_ORDER_QTY                      AS  D2_ORDER_QUANTITY
      , A.D3_ORDER_QTY                      AS  D3_ORDER_QUANTITY
      , A.D4_ORDER_QTY                      AS  D4_ORDER_QUANTITY
      , A.D5_ORDER_QTY                      AS  D5_ORDER_QUANTITY
      , A.D6_ORDER_QTY                      AS  D6_ORDER_QUANTITY
      , A.D7_ORDER_QTY                      AS  D7_ORDER_QUANTITY
      , A.D8_ORDER_QTY                      AS  D8_ORDER_QUANTITY
      , A.D9_ORDER_QTY                      AS  D9_ORDER_QUANTITY
      , A.D10_ORDER_QTY                     AS  D10_ORDER_QUANTITY
      , A.D11_ORDER_QTY                     AS  D11_ORDER_QUANTITY
      , A.D12_ORDER_QTY                     AS  D12_ORDER_QUANTITY
      , A.D13_ORDER_QTY                     AS  D13_ORDER_QUANTITY
      , A.D14_ORDER_QTY                     AS  D14_ORDER_QUANTITY
      , A.D15_ORDER_QTY                     AS  D15_ORDER_QUANTITY
      , A.D0_ORDER_DISCARD_QTY              AS  D0_ORDER_DISCARD_QTY
      , A.CREATE_ID                         AS  CREATE_ID
      , A.CREATE_DT                         AS  CREATE_DATE
      , A.MODIFY_ID                         AS  MODIFY_ID
      , A.MODIFY_DT                         AS  MODIFY_DATE
      , B.IL_ITEM_CD                        AS  IL_ITEM_CODE
      , B.UR_SUPPLIER_WAREHOUSE_ID          AS  UR_SUPPLIER_WAREHOUSE_ID
      , B.UNLIMIT_STOCK_YN                  AS  UNLIMIT_STOCK_YN
      , B.PRE_ORDER_YN                      AS  PRE_ORDER_YN
      , B.PRE_ORDER_TP                      AS  PRE_ORDER_TYPE
      , B.MEMO                              AS  MEMO
      , CASE WHEN G.BASIC_YN = 'Y' THEN CONCAT('(기본설정)유통기간:', G.DISTRIBUTION_PERIOD, '일',' / 임박기준:', G.IMMINENT,'일',' / 출고기준:', G.DELIVERY,'일',' / 목표재고:', G.TARGET_STOCK_RATIO,'%')
             WHEN G.BASIC_YN = 'N' THEN CONCAT('유통기간:', G.DISTRIBUTION_PERIOD, '일',' / 임박기준:', G.IMMINENT,'일',' / 출고기준:', G.DELIVERY,'일',' / 목표재고:',G.TARGET_STOCK_RATIO,'%')
             ELSE ''
		END AS NAME
      , B.IL_STOCK_DEADLINE_ID
      , UW.WAREHOUSE_NM AS WAREHOUSE_NM
      , (
			SELECT
				COUNT(1) AS GOODS_DISPOSAL_CNT
			FROM
				IL_GOODS
			WHERE
				GOODS_TP = 'GOODS_TYPE.DISPOSAL'
				AND IL_ITEM_CD = D.IL_ITEM_CD
				AND UR_WAREHOUSE_ID = UW.UR_WAREHOUSE_ID
      ) AS GOODS_DISPOSAL_CNT
      , IFNULL((
			SELECT
				STOCK_QTY
			FROM
				IL_ITEM_ERP_STOCK_HISTORY
			WHERE
				BASE_DT = #{baseDt}
				AND IL_ITEM_WAREHOUSE_ID = A.IL_ITEM_WAREHOUSE_ID
				AND STOCK_TP = 'ERP_STOCK_TP.CLOSED'
			ORDER BY CREATE_DT DESC
			LIMIT 1
      ), 0) AS D0_STOCK_CLOSED_QTY
      , IFNULL((
			SELECT
				STOCK_QTY
			FROM
				IL_ITEM_ERP_STOCK_HISTORY
			WHERE
				BASE_DT = #{baseDt}
				AND IL_ITEM_WAREHOUSE_ID = A.IL_ITEM_WAREHOUSE_ID
				AND STOCK_TP = 'ERP_STOCK_TP.CONFIRMED'
			ORDER BY CREATE_DT DESC
			LIMIT 1
      ), 0) AS D0_STOCK_CONFIRMED_QTY
      , IFNULL((
			SELECT
				STOCK_QTY
			FROM
				IL_ITEM_ERP_STOCK_HISTORY
			WHERE
				BASE_DT = #{baseDt}
				AND IL_ITEM_WAREHOUSE_ID = A.IL_ITEM_WAREHOUSE_ID
				AND STOCK_TP = 'ERP_STOCK_TP.CLOSED_ADJ'
			ORDER BY CREATE_DT DESC
			LIMIT 1
      ), 0) AS D0_STOCK_CLOSED_ADJ_QTY
      , IFNULL((
			SELECT
				STOCK_QTY
			FROM
				IL_ITEM_ERP_STOCK_HISTORY
			WHERE
				BASE_DT = #{baseDt}
				AND IL_ITEM_WAREHOUSE_ID = A.IL_ITEM_WAREHOUSE_ID
				AND STOCK_TP = 'ERP_STOCK_TP.SCHEDULED_ADJ'
			ORDER BY CREATE_DT DESC
			LIMIT 1
      ), 0) AS D0_STOCK_SCHEDULED_ADJ_QTY
      , IFNULL((
			SELECT
				STOCK_QTY
			FROM
				IL_ITEM_ERP_STOCK_HISTORY
			WHERE
				BASE_DT = #{baseDt}
				AND IL_ITEM_WAREHOUSE_ID = A.IL_ITEM_WAREHOUSE_ID
				AND STOCK_TP = 'ERP_STOCK_TP.CONFIRMED_ADJ'
			ORDER BY CREATE_DT DESC
			LIMIT 1
      ), 0) AS D0_STOCK_CONFIRMED_ADJ_QTY
	FROM
		IL_ITEM_STOCK_HISTORY A
		INNER JOIN  IL_ITEM_WAREHOUSE  B
			ON A.IL_ITEM_WAREHOUSE_ID = B.IL_ITEM_WAREHOUSE_ID
			AND B.IL_ITEM_WAREHOUSE_ID = #{ilItemWarehouseId}
		INNER JOIN IL_ITEM D
			ON D.IL_ITEM_CD = B.IL_ITEM_CD
		INNER JOIN UR_SUPPLIER_WAREHOUSE E
			ON B.UR_SUPPLIER_WAREHOUSE_ID = E.UR_SUPPLIER_WAREHOUSE_ID
		INNER JOIN UR_SUPPLIER F
			ON E.UR_SUPPLIER_ID = F.UR_SUPPLIER_ID
		INNER JOIN UR_WAREHOUSE UW
			ON UW.UR_WAREHOUSE_ID = E.UR_WAREHOUSE_ID
		LEFT JOIN IL_STOCK_DEADLINE G
			ON G.IL_STOCK_DEADLINE_ID = B.IL_STOCK_DEADLINE_ID
		LEFT JOIN IL_PO_TP IPT
			ON IPT.IL_PO_TP_ID = B.IL_PO_TP_ID
	WHERE
		A.BASE_DT = #{baseDt}
	GROUP BY IL_ITEM_WAREHOUSE_ID
  </select>


  <!--───────────────────────────────────────────────────────────────────────
   * description : 품목별 재고리스트 주문수량 조회
   * @
   * @ 수정일                   수정자   수정내용
   * @ ──────────────────────────────────────────────────────────────────────
   * @ 2021.1.20   이성준   최초생성
   * @
  ────────────────────────────────────────────────────────────────────────-->
	<select id="getStockOrderQty" parameterType="java.util.Map" resultType="kr.co.pulmuone.v1.goods.stock.dto.vo.StockListResultVo">
	/* stockList.getStockOrderQty */
		SELECT
			IFNULL(SUM(IF(T.STOCK_TP = 'ERP_STOCK_TP.ORDER' AND T.DDAY = 0, T.STOCK_QTY, 0)),0) AS D0_QUANTITY
			, IFNULL(SUM(IF(T.STOCK_TP = 'ERP_STOCK_TP.ORDER' AND T.DDAY = 1, T.STOCK_QTY, 0)),0) AS D1_QUANTITY
			, IFNULL(SUM(IF(T.STOCK_TP = 'ERP_STOCK_TP.ORDER' AND T.DDAY = 2, T.STOCK_QTY, 0)),0) AS D2_QUANTITY
			, IFNULL(SUM(IF(T.STOCK_TP = 'ERP_STOCK_TP.ORDER' AND T.DDAY = 3, T.STOCK_QTY, 0)),0) AS D3_QUANTITY
			, IFNULL(SUM(IF(T.STOCK_TP = 'ERP_STOCK_TP.ORDER' AND T.DDAY = 4, T.STOCK_QTY, 0)),0) AS D4_QUANTITY
			, IFNULL(SUM(IF(T.STOCK_TP = 'ERP_STOCK_TP.ORDER' AND T.DDAY = 5, T.STOCK_QTY, 0)),0) AS D5_QUANTITY
			, IFNULL(SUM(IF(T.STOCK_TP = 'ERP_STOCK_TP.ORDER' AND T.DDAY = 6, T.STOCK_QTY, 0)),0) AS D6_QUANTITY
			, IFNULL(SUM(IF(T.STOCK_TP = 'ERP_STOCK_TP.ORDER' AND T.DDAY = 7, T.STOCK_QTY, 0)),0) AS D7_QUANTITY
			, IFNULL(SUM(IF(T.STOCK_TP = 'ERP_STOCK_TP.ORDER' AND T.DDAY = 8, T.STOCK_QTY, 0)),0) AS D8_QUANTITY
			, IFNULL(SUM(IF(T.STOCK_TP = 'ERP_STOCK_TP.ORDER' AND T.DDAY = 9, T.STOCK_QTY, 0)),0) AS D9_QUANTITY
			, IFNULL(SUM(IF(T.STOCK_TP = 'ERP_STOCK_TP.ORDER' AND T.DDAY = 10, T.STOCK_QTY, 0)),0) AS D10_QUANTITY
			, IFNULL(SUM(IF(T.STOCK_TP = 'ERP_STOCK_TP.ORDER' AND T.DDAY = 11, T.STOCK_QTY, 0)),0) AS D11_QUANTITY
			, IFNULL(SUM(IF(T.STOCK_TP = 'ERP_STOCK_TP.ORDER' AND T.DDAY = 12, T.STOCK_QTY, 0)),0) AS D12_QUANTITY
			, IFNULL(SUM(IF(T.STOCK_TP = 'ERP_STOCK_TP.ORDER' AND T.DDAY = 13, T.STOCK_QTY, 0)),0) AS D13_QUANTITY
			, IFNULL(SUM(IF(T.STOCK_TP = 'ERP_STOCK_TP.ORDER' AND T.DDAY = 14, T.STOCK_QTY, 0)),0) AS D14_QUANTITY
			, IFNULL(SUM(IF(T.STOCK_TP = 'ERP_STOCK_TP.ORDER' AND T.DDAY = 15, T.STOCK_QTY, 0)),0) AS D15_QUANTITY
			, IFNULL(SUM(IF(T.STOCK_TP = 'ERP_STOCK_TP.DISCARD_ORDER' AND T.DDAY = 0, T.STOCK_QTY, 0)),0) AS D0_DISCARD_QUANTITY
			, IFNULL(SUM(IF(T.STOCK_TP = 'ERP_STOCK_TP.SCHEDULED' AND T.DDAY = 0, T.STOCK_QTY, 0)),0) AS D0_STOCK_SCHEDULED_QUANTITY
			, IFNULL(SUM(IF(T.STOCK_TP = 'ERP_STOCK_TP.SCHEDULED' AND T.DDAY = 1, T.STOCK_QTY, 0)),0) AS D1_STOCK_SCHEDULED_QUANTITY
			, IFNULL(SUM(IF(T.STOCK_TP = 'ERP_STOCK_TP.SCHEDULED' AND T.DDAY = 2, T.STOCK_QTY, 0)),0) AS D2_STOCK_SCHEDULED_QUANTITY
			, IFNULL(SUM(IF(T.STOCK_TP = 'ERP_STOCK_TP.SCHEDULED' AND T.DDAY = 3, T.STOCK_QTY, 0)),0) AS D3_STOCK_SCHEDULED_QUANTITY
			, IFNULL(SUM(IF(T.STOCK_TP = 'ERP_STOCK_TP.SCHEDULED' AND T.DDAY = 4, T.STOCK_QTY, 0)),0) AS D4_STOCK_SCHEDULED_QUANTITY
			, IFNULL(SUM(IF(T.STOCK_TP = 'ERP_STOCK_TP.SCHEDULED' AND T.DDAY = 5, T.STOCK_QTY, 0)),0) AS D5_STOCK_SCHEDULED_QUANTITY
			, IFNULL(SUM(IF(T.STOCK_TP = 'ERP_STOCK_TP.SCHEDULED' AND T.DDAY = 6, T.STOCK_QTY, 0)),0) AS D6_STOCK_SCHEDULED_QUANTITY
			, IFNULL(SUM(IF(T.STOCK_TP = 'ERP_STOCK_TP.SCHEDULED' AND T.DDAY = 7, T.STOCK_QTY, 0)),0) AS D7_STOCK_SCHEDULED_QUANTITY
			, IFNULL(SUM(IF(T.STOCK_TP = 'ERP_STOCK_TP.SCHEDULED' AND T.DDAY = 8, T.STOCK_QTY, 0)),0) AS D8_STOCK_SCHEDULED_QUANTITY
			, IFNULL(SUM(IF(T.STOCK_TP = 'ERP_STOCK_TP.SCHEDULED' AND T.DDAY = 9, T.STOCK_QTY, 0)),0) AS D9_STOCK_SCHEDULED_QUANTITY
			, IFNULL(SUM(IF(T.STOCK_TP = 'ERP_STOCK_TP.SCHEDULED' AND T.DDAY = 10, T.STOCK_QTY, 0)),0) AS D10_STOCK_SCHEDULED_QUANTITY
			, IFNULL(SUM(IF(T.STOCK_TP = 'ERP_STOCK_TP.SCHEDULED' AND T.DDAY = 11, T.STOCK_QTY, 0)),0) AS D11_STOCK_SCHEDULED_QUANTITY
			, IFNULL(SUM(IF(T.STOCK_TP = 'ERP_STOCK_TP.SCHEDULED' AND T.DDAY = 12, T.STOCK_QTY, 0)),0) AS D12_STOCK_SCHEDULED_QUANTITY
			, IFNULL(SUM(IF(T.STOCK_TP = 'ERP_STOCK_TP.SCHEDULED' AND T.DDAY = 13, T.STOCK_QTY, 0)),0) AS D13_STOCK_SCHEDULED_QUANTITY
			, IFNULL(SUM(IF(T.STOCK_TP = 'ERP_STOCK_TP.SCHEDULED' AND T.DDAY = 14, T.STOCK_QTY, 0)),0) AS D14_STOCK_SCHEDULED_QUANTITY
			, IFNULL(SUM(IF(T.STOCK_TP = 'ERP_STOCK_TP.SCHEDULED' AND T.DDAY = 15, T.STOCK_QTY, 0)),0) AS D15_STOCK_SCHEDULED_QUANTITY
		FROM (
			SELECT
				IIESH.STOCK_QTY
				, DATEDIFF(IIESH.SCHEDULE_DT, BASE_DT.BASE_DT) AS DDAY
				, IIESH.STOCK_TP AS STOCK_TP
			FROM
				IL_ITEM_ERP_STOCK_HISTORY IIESH
				JOIN (
					SELECT
						#{baseDt} AS BASE_DT
				) BASE_DT
			WHERE
				IIESH.IL_ITEM_WAREHOUSE_ID = #{ilItemWarehouseId} /* 품목별 출고처ID */
				AND IIESH.STOCK_TP IN ('ERP_STOCK_TP.ORDER', 'ERP_STOCK_TP.DISCARD_ORDER', 'ERP_STOCK_TP.SCHEDULED') /* 재고타입-주문, 입고예정 */
				AND IIESH.BASE_DT <![CDATA[ >= ]]> BASE_DT.BASE_DT
		) T
  </select>

  <select id="getStockDetailSum" parameterType="java.util.Map" resultType="kr.co.pulmuone.v1.goods.stock.dto.vo.StockListResultVo">
  /* stockList.getStockDetailSum */
   SELECT STOCK_QTY AS TOTAL_SUM
     FROM IL_ITEM_ERP_STOCK_HISTORY IIES
    WHERE IIES.IL_ITEM_WAREHOUSE_ID =#{ilItemWarehouseId}
      AND IIES.BASE_DT = #{baseDt}
      AND IIES.STOCK_TP ='ERP_STOCK_TP.CLOSED'
  </select>


  <resultMap type="kr.co.pulmuone.v1.goods.stock.dto.vo.StockListResultVo" id="stockDetailListMap">
    <result column="IL_ITEM_WAREHOUSE_ID" property="ilItemWarehouseId" />
    <result column="BASE_DT"  property="baseDt" />
    <result column="EXPIRATION_DT"  property="expirationDt" />
    <result column="DISTRIBUTION_PERIOD" property="distributionPeriod" />
    <result column="STOCK_TP" property="stockTp" />
    <result column="STOCK_NM" property="stockNm" />
    <result column="STOCK_QTY" property="stockQty" />
    <result column="STOCK_SCHEDULED_COUNT" property="stockScheduledCount" />
    <result column="REST_DISTRIBUTION_PERIOD" property="restDistributionPeriod" />
    <result column="REST_DISTRIBUTION_DDAY" property="restDistributionDday" />
  </resultMap>
   <!--───────────────────────────────────────────────────────────────────────
   * description : 품목별 재고리스트 조회
   * @
   * @ 수정일                   수정자   수정내용
   * @ ──────────────────────────────────────────────────────────────────────
   * @ 2020.11.06  이성준   최초생성
   * @
  ────────────────────────────────────────────────────────────────────────-->
  <select id="getStockDetailList" resultMap="stockDetailListMap">
  /* stockList.getStockDetailList */
  SELECT DATEDIFF(IISE.EXPIRATION_DT, IISE.BASE_DT) AS REST_DISTRIBUTION_PERIOD, /* 잔여 유통기간 */
         IFNULL(ISD.DELIVERY, 0) - DATEDIFF(IISE.EXPIRATION_DT, IISE.BASE_DT) AS REST_DISTRIBUTION_DDAY, /* 출고기준 잔여 유통기간 */
         IISE.EXPIRATION_DT, /* 유통기한 */
         IISE.STOCK_QTY,     /* 재고수량 */
         IISE.STOCK_TP,      /* 재고유형 */
         IISE.IL_ITEM_WAREHOUSE_ID, /* 품목별 출고처ID */
         FN_COMN_CODE_DIC(IISE.STOCK_TP) AS STOCK_NM /* 재고유형명 */
    FROM IL_ITEM_STOCK_EXPR IISE
	INNER JOIN IL_ITEM_WAREHOUSE IIW ON IIW.IL_ITEM_WAREHOUSE_ID = IISE.IL_ITEM_WAREHOUSE_ID
	LEFT JOIN IL_STOCK_DEADLINE ISD ON ISD.IL_STOCK_DEADLINE_ID = IIW.IL_STOCK_DEADLINE_ID
    <where>
        <if test="@kr.co.pulmuone.v1.comm.util.StringUtil@isNotEmpty(ilItemWarehouseId)">
               IISE.IL_ITEM_WAREHOUSE_ID = #{ilItemWarehouseId}
        </if>
        <if test="@kr.co.pulmuone.v1.comm.util.StringUtil@isNotEmpty(baseDt)">
           AND IISE.BASE_DT = #{baseDt}
        </if>
    </where>
    ORDER BY IISE.EXPIRATION_DT
  </select>

  <!--───────────────────────────────────────────────────────────────────────
   * description : 공통 선주문 설정 팝업 정보 조회
   * @
   * @ 수정일                   수정자   수정내용
   * @ ──────────────────────────────────────────────────────────────────────
   * @ 2021.01.10  원종한   최초생성
   * @
  ────────────────────────────────────────────────────────────────────────-->
  <select id="getStockPreOrderPopupInfo" resultMap="stockListMap">
  /* stockList.getStockPreOrderPopupInfo */
	SELECT
		B.IL_ITEM_CD AS IL_ITEM_CD
		, B.ITEM_NM AS ITEM_NM
		, E.WAREHOUSE_NM AS WAREHOUSE_NM
		, CASE
			WHEN D.SUPPLIER_CD = 'PF' THEN 'PRE_ORDER_TP.UNLIMITED_ALLOWED'
			WHEN D.SUPPLIER_CD = 'OG' AND B.ERP_CTGRY_LV1_ID = '과일' AND G.ERP_PO_TP = 'ERP_PO_TP.R1' THEN 'PRE_ORDER_TP.UNLIMITED_ALLOWED'
			WHEN D.SUPPLIER_CD = 'OG' AND B.ERP_CTGRY_LV1_ID NOT IN ('과일', '채소') AND G.ERP_PO_TP = 'ERP_PO_TP.R1' THEN 'PRE_ORDER_TP.LIMITED_ALLOWED'
		  END AS DEFAULT_PRE_ORDER_TYPE	/* 기본 선주문 유형 */
		, CASE
			WHEN D.SUPPLIER_CD = 'PF' THEN '선주문(식품)'
			WHEN D.SUPPLIER_CD = 'OG' AND B.ERP_CTGRY_LV1_ID = '과일' AND G.ERP_PO_TP = 'ERP_PO_TP.R1' THEN '선주문(과일)'
			WHEN D.SUPPLIER_CD = 'OG' AND B.ERP_CTGRY_LV1_ID NOT IN ('과일', '채소') AND G.ERP_PO_TP = 'ERP_PO_TP.R1' THEN '선주문(가공)'
		   END AS PRE_ORDER_NM	/* 기본 재고운영 형태 */
		, A.PRE_ORDER_TP AS PRE_ORDER_TYPE /* 현재 선주문 유형 */
		, F.COMP_NM AS SUPPLIER_NM /* 공급처명 */
	FROM IL_ITEM_WAREHOUSE A
		INNER JOIN IL_ITEM B
			ON B.IL_ITEM_CD = A.IL_ITEM_CD
		INNER JOIN  UR_SUPPLIER_WAREHOUSE C
			ON C.UR_SUPPLIER_WAREHOUSE_ID = A.UR_SUPPLIER_WAREHOUSE_ID
		INNER JOIN UR_SUPPLIER D
			ON D.UR_SUPPLIER_ID = C.UR_SUPPLIER_ID
		INNER JOIN  UR_WAREHOUSE E
			ON E.UR_WAREHOUSE_ID = C.UR_WAREHOUSE_ID
		INNER JOIN UR_COMPANY F
			ON F.UR_COMPANY_ID = D.UR_COMPANY_ID
		LEFT JOIN IL_PO_TP G
			ON G.IL_PO_TP_ID = A.IL_PO_TP_ID
	WHERE
		A.PRE_ORDER_YN = 'Y'
		AND A.IL_ITEM_WAREHOUSE_ID = #{ilItemWarehouseId}
  </select>


  <!--───────────────────────────────────────────────────────────────────────
   * description : 품목별 재고리스트 선주문 여부 수정
   * @
   * @ 수정일                   수정자   수정내용
   * @ ──────────────────────────────────────────────────────────────────────
   * @ 2020.11.06  이성준   최초생성
   * @
  ────────────────────────────────────────────────────────────────────────-->
  <update id="putStockPreOrder">
  /* stockList.putStockPreOrder */
   UPDATE  IL_ITEM_WAREHOUSE
	  SET  PRE_ORDER_TP = #{popPreOrderTp}
		  ,MODIFY_ID    = #{userVo.userId}
		  ,MODIFY_DT    = NOW()
	WHERE 1=1
	  AND IL_ITEM_WAREHOUSE_ID = #{ilItemWarehouseId}
  </update>


  <!--───────────────────────────────────────────────────────────────────────
   * description : 출고기준관리 조회
   * @
   * @ 수정일                   수정자   수정내용
   * @ ──────────────────────────────────────────────────────────────────────
   * @ 2020.12.29  이성준   최초생성
   * @
  ────────────────────────────────────────────────────────────────────────-->
  <select id="getStockDeadlineDropDownList" resultMap="stockListMap">
  /* stockList.getStockDeadlineDropDownList */
		SELECT
			CONCAT(IF(ISD.BASIC_YN = 'Y', '(기본설정) ', ''), '유통기간:', ISD.DISTRIBUTION_PERIOD, '일', ' / 임박기준:', ISD.IMMINENT,'일', ' / 출고기준:', ISD.DELIVERY, '일', ' / 목표재고:', ISD.TARGET_STOCK_RATIO, '%') AS NAME
		   , ISD.IL_STOCK_DEADLINE_ID AS IL_STOCK_DEADLINE_ID
		FROM
			IL_STOCK_DEADLINE ISD
		INNER JOIN (
			SELECT
				A.UR_SUPPLIER_ID
				, A.UR_WAREHOUSE_ID
				, A.DISTRIBUTION_PERIOD
			FROM
				IL_STOCK_DEADLINE A
				INNER JOIN IL_ITEM_WAREHOUSE B
					ON B.IL_ITEM_WAREHOUSE_ID = #{ilItemWarehouseId}
				INNER JOIN UR_SUPPLIER_WAREHOUSE C
					ON C.UR_SUPPLIER_WAREHOUSE_ID = B.UR_SUPPLIER_WAREHOUSE_ID
				INNER JOIN IL_ITEM D
					ON D.IL_ITEM_CD = B.IL_ITEM_CD
			WHERE
				A.UR_SUPPLIER_ID = C.UR_SUPPLIER_ID
				AND A.UR_WAREHOUSE_ID IN (C.UR_WAREHOUSE_ID, 0)
				AND A.DISTRIBUTION_PERIOD <![CDATA[ <= ]]> D.DISTRIBUTION_PERIOD
			ORDER BY A.UR_WAREHOUSE_ID DESC, A.DISTRIBUTION_PERIOD DESC
			LIMIT 1
		) T
			ON T.UR_SUPPLIER_ID = ISD.UR_SUPPLIER_ID
			AND T.UR_WAREHOUSE_ID = ISD.UR_WAREHOUSE_ID
			AND T.DISTRIBUTION_PERIOD = ISD.DISTRIBUTION_PERIOD
		ORDER BY ISD.BASIC_YN DESC
  </select>


  <!--───────────────────────────────────────────────────────────────────────
   * description : 출고기준관리 수정
   * @
   * @ 수정일                   수정자   수정내용
   * @ ──────────────────────────────────────────────────────────────────────
   * @ 2020.12.30  이성준   최초생성
   * @
  ────────────────────────────────────────────────────────────────────────-->
  <update id="putStockDeadlineInfoBasicYn">
  /* stockList.putStockDeadlineInfoBasicYn */
   UPDATE  IL_STOCK_DEADLINE
	  SET  BASIC_YN  = 'N'
		  ,MODIFY_ID = #{userVo.userId}
		  ,MODIFY_DT = NOW()
	WHERE 1=1
	  AND UR_SUPPLIER_ID  = #{urSupplierId}
    <if test="@kr.co.pulmuone.v1.comm.util.StringUtil@isNotEmpty(urWarehouseId)">
      AND UR_WAREHOUSE_ID = #{urWarehouseId}
    </if>
    <if test="@kr.co.pulmuone.v1.comm.util.StringUtil@isEmpty(urWarehouseId)">
      AND (UR_WAREHOUSE_ID = 0 OR UR_WAREHOUSE_ID IS NULL)
    </if>
  </update>

  <update id="putStockDeadlineInfo">
  /* stockList.putStockDeadlineInfo */
   UPDATE  IL_STOCK_DEADLINE
	  SET  BASIC_YN  = 'Y'
		  ,MODIFY_ID = #{userVo.userId}
		  ,MODIFY_DT = NOW()
	WHERE 1=1
	  AND IL_STOCK_DEADLINE_ID = #{popIlStockDeadlineId}
  </update>
	<resultMap type="kr.co.pulmuone.v1.goods.stock.dto.vo.StockListResultVo" id="packageStockInfoMap">
		<result column="D0_ORDER_QTY" property="d0orderQuantity" javaType="long" jdbcType="INTEGER" />
		<result column="D1_ORDER_QTY" property="d1orderQuantity" javaType="long" jdbcType="INTEGER" />
		<result column="D2_ORDER_QTY" property="d2orderQuantity" javaType="long" jdbcType="INTEGER" />
		<result column="D3_ORDER_QTY" property="d3orderQuantity" javaType="long" jdbcType="INTEGER" />
		<result column="D4_ORDER_QTY" property="d4orderQuantity" javaType="long" jdbcType="INTEGER" />
		<result column="D5_ORDER_QTY" property="d5orderQuantity" javaType="long" jdbcType="INTEGER" />
		<result column="D6_ORDER_QTY" property="d6orderQuantity" javaType="long" jdbcType="INTEGER" />
		<result column="D7_ORDER_QTY" property="d7orderQuantity" javaType="long" jdbcType="INTEGER" />
		<result column="D8_ORDER_QTY" property="d8orderQuantity" javaType="long" jdbcType="INTEGER" />
		<result column="D9_ORDER_QTY" property="d9orderQuantity" javaType="long" jdbcType="INTEGER" />
		<result column="D10_ORDER_QTY" property="d10orderQuantity" javaType="long" jdbcType="INTEGER" />
		<result column="D11_ORDER_QTY" property="d11orderQuantity" javaType="long" jdbcType="INTEGER" />
		<result column="D12_ORDER_QTY" property="d12orderQuantity" javaType="long" jdbcType="INTEGER" />
		<result column="D13_ORDER_QTY" property="d13orderQuantity" javaType="long" jdbcType="INTEGER" />
		<result column="D14_ORDER_QTY" property="d14orderQuantity" javaType="long" jdbcType="INTEGER" />
		<result column="D15_ORDER_QTY" property="d15orderQuantity" javaType="long" jdbcType="INTEGER" />
		<result column="WAREHOUSE_NM" property="warehouseNm" />
		<result column="GOODS_NM" property="goodsNm"/>
		<result column="IL_GOODS_ID" property="ilGoodsId"/>
		<collection column="{ilGoodsId = IL_GOODS_ID}"  property="orderQtyList" javaType="java.util.ArrayList"
					ofType="kr.co.pulmuone.v1.goods.stock.dto.vo.StockListResultVo" select="getOrderQtyList"/>
	</resultMap>
	<select id="getPackageGoodsStockInfo" resultMap="packageStockInfoMap">
		/* stockList.getPackageGoodsStockInfo */
		SELECT
			TRUNCATE(MIN(T.D0_ORDER_QTY/T.GOODS_QTY), 0) AS D0_ORDER_QTY
			, 	TRUNCATE(MIN(T.D1_ORDER_QTY/T.GOODS_QTY), 0) AS D1_ORDER_QTY
			, 	TRUNCATE(MIN(T.D2_ORDER_QTY/T.GOODS_QTY), 0) AS D2_ORDER_QTY
			, 	TRUNCATE(MIN(T.D3_ORDER_QTY/T.GOODS_QTY), 0) AS D3_ORDER_QTY
			, 	TRUNCATE(MIN(T.D4_ORDER_QTY/T.GOODS_QTY), 0) AS D4_ORDER_QTY
			, 	TRUNCATE(MIN(T.D5_ORDER_QTY/T.GOODS_QTY), 0) AS D5_ORDER_QTY
			, 	TRUNCATE(MIN(T.D6_ORDER_QTY/T.GOODS_QTY), 0) AS D6_ORDER_QTY
			, 	TRUNCATE(MIN(T.D7_ORDER_QTY/T.GOODS_QTY), 0) AS D7_ORDER_QTY
			, 	TRUNCATE(MIN(T.D8_ORDER_QTY/T.GOODS_QTY), 0) AS D8_ORDER_QTY
			, 	TRUNCATE(MIN(T.D9_ORDER_QTY/T.GOODS_QTY), 0) AS D9_ORDER_QTY
			, 	TRUNCATE(MIN(T.D10_ORDER_QTY/T.GOODS_QTY), 0) AS D10_ORDER_QTY
			, 	TRUNCATE(MIN(T.D11_ORDER_QTY/T.GOODS_QTY), 0) AS D11_ORDER_QTY
			, 	TRUNCATE(MIN(T.D12_ORDER_QTY/T.GOODS_QTY), 0) AS D12_ORDER_QTY
			, 	TRUNCATE(MIN(T.D13_ORDER_QTY/T.GOODS_QTY), 0) AS D13_ORDER_QTY
			, 	TRUNCATE(MIN(T.D14_ORDER_QTY/T.GOODS_QTY), 0) AS D14_ORDER_QTY
			, 	TRUNCATE(MIN(T.D15_ORDER_QTY/T.GOODS_QTY), 0) AS D15_ORDER_QTY
		,	T.WAREHOUSE_NM AS WAREHOUSE_NM
			 , 	T.IL_GOODS_ID AS IL_GOODS_ID
			 ,	T.GOODS_NM AS GOODS_NM
		FROM(
				SELECT
					IFNULL((CASE
								WHEN UW.STOCK_ORDER_YN = 'Y' AND IG.GOODS_TP = 'GOODS_TYPE.DISPOSAL' THEN IIS.D0_STOCK_DISCARD_QTY
								WHEN UW.STOCK_ORDER_YN = 'Y' THEN IIS.D0_ORDER_QTY
								WHEN UW.STOCK_ORDER_YN = 'N' AND IIW.UNLIMIT_STOCK_YN = 'Y' THEN 9999
								ELSE IIW.NOT_IF_STOCK_CNT END
							   ), 0) AS D0_ORDER_QTY
					, IFNULL((CASE
								WHEN UW.STOCK_ORDER_YN = 'Y' AND IG.GOODS_TP = 'GOODS_TYPE.DISPOSAL' THEN IIS.D0_STOCK_DISCARD_QTY
								WHEN UW.STOCK_ORDER_YN = 'Y' THEN IIS.D1_ORDER_QTY
								WHEN UW.STOCK_ORDER_YN = 'N' AND IIW.UNLIMIT_STOCK_YN = 'Y' THEN 9999
								ELSE IIW.NOT_IF_STOCK_CNT END
							  ), 0) AS D1_ORDER_QTY
					, IFNULL((CASE
								WHEN UW.STOCK_ORDER_YN = 'Y' AND IG.GOODS_TP = 'GOODS_TYPE.DISPOSAL' THEN IIS.D0_STOCK_DISCARD_QTY
								WHEN UW.STOCK_ORDER_YN = 'Y' THEN IIS.D2_ORDER_QTY
								WHEN UW.STOCK_ORDER_YN = 'N' AND IIW.UNLIMIT_STOCK_YN = 'Y' THEN 9999
								ELSE IIW.NOT_IF_STOCK_CNT END
							  ), 0) AS D2_ORDER_QTY
					, IFNULL((CASE
								WHEN UW.STOCK_ORDER_YN = 'Y' AND IG.GOODS_TP = 'GOODS_TYPE.DISPOSAL' THEN IIS.D0_STOCK_DISCARD_QTY
								WHEN UW.STOCK_ORDER_YN = 'Y' THEN IIS.D3_ORDER_QTY
								WHEN UW.STOCK_ORDER_YN = 'N' AND IIW.UNLIMIT_STOCK_YN = 'Y' THEN 9999
								ELSE IIW.NOT_IF_STOCK_CNT END
							  ), 0) AS D3_ORDER_QTY
					, IFNULL((CASE
								WHEN UW.STOCK_ORDER_YN = 'Y' AND IG.GOODS_TP = 'GOODS_TYPE.DISPOSAL' THEN IIS.D0_STOCK_DISCARD_QTY
								WHEN UW.STOCK_ORDER_YN = 'Y' THEN IIS.D4_ORDER_QTY
								WHEN UW.STOCK_ORDER_YN = 'N' AND IIW.UNLIMIT_STOCK_YN = 'Y' THEN 9999
								ELSE IIW.NOT_IF_STOCK_CNT END
							  ), 0) AS D4_ORDER_QTY
					, IFNULL((CASE
								WHEN UW.STOCK_ORDER_YN = 'Y' AND IG.GOODS_TP = 'GOODS_TYPE.DISPOSAL' THEN IIS.D0_STOCK_DISCARD_QTY
								WHEN UW.STOCK_ORDER_YN = 'Y' THEN IIS.D5_ORDER_QTY
								WHEN UW.STOCK_ORDER_YN = 'N' AND IIW.UNLIMIT_STOCK_YN = 'Y' THEN 9999
								ELSE IIW.NOT_IF_STOCK_CNT END
							  ), 0) AS D5_ORDER_QTY
					, IFNULL((CASE
								WHEN UW.STOCK_ORDER_YN = 'Y' AND IG.GOODS_TP = 'GOODS_TYPE.DISPOSAL' THEN IIS.D0_STOCK_DISCARD_QTY
								WHEN UW.STOCK_ORDER_YN = 'Y' THEN IIS.D6_ORDER_QTY
								WHEN UW.STOCK_ORDER_YN = 'N' AND IIW.UNLIMIT_STOCK_YN = 'Y' THEN 9999
								ELSE IIW.NOT_IF_STOCK_CNT END
							  ), 0) AS D6_ORDER_QTY
					, IFNULL((CASE
								WHEN UW.STOCK_ORDER_YN = 'Y' AND IG.GOODS_TP = 'GOODS_TYPE.DISPOSAL' THEN IIS.D0_STOCK_DISCARD_QTY
								WHEN UW.STOCK_ORDER_YN = 'Y' THEN IIS.D7_ORDER_QTY
								WHEN UW.STOCK_ORDER_YN = 'N' AND IIW.UNLIMIT_STOCK_YN = 'Y' THEN 9999
								ELSE IIW.NOT_IF_STOCK_CNT END
							  ), 0) AS D7_ORDER_QTY
					, IFNULL((CASE
								WHEN UW.STOCK_ORDER_YN = 'Y' AND IG.GOODS_TP = 'GOODS_TYPE.DISPOSAL' THEN IIS.D0_STOCK_DISCARD_QTY
								WHEN UW.STOCK_ORDER_YN = 'Y' THEN IIS.D8_ORDER_QTY
								WHEN UW.STOCK_ORDER_YN = 'N' AND IIW.UNLIMIT_STOCK_YN = 'Y' THEN 9999
								ELSE IIW.NOT_IF_STOCK_CNT END
							  ), 0) AS D8_ORDER_QTY
					, IFNULL((CASE
								WHEN UW.STOCK_ORDER_YN = 'Y' AND IG.GOODS_TP = 'GOODS_TYPE.DISPOSAL' THEN IIS.D0_STOCK_DISCARD_QTY
								WHEN UW.STOCK_ORDER_YN = 'Y' THEN IIS.D9_ORDER_QTY
								WHEN UW.STOCK_ORDER_YN = 'N' AND IIW.UNLIMIT_STOCK_YN = 'Y' THEN 9999
								ELSE IIW.NOT_IF_STOCK_CNT END
							   ), 0) AS D9_ORDER_QTY
					, IFNULL((CASE
							   WHEN UW.STOCK_ORDER_YN = 'Y' AND IG.GOODS_TP = 'GOODS_TYPE.DISPOSAL' THEN IIS.D0_STOCK_DISCARD_QTY
							   WHEN UW.STOCK_ORDER_YN = 'Y' THEN IIS.D10_ORDER_QTY
							   WHEN UW.STOCK_ORDER_YN = 'N' AND IIW.UNLIMIT_STOCK_YN = 'Y' THEN 9999
							   ELSE IIW.NOT_IF_STOCK_CNT END
							  ), 0) AS D10_ORDER_QTY
					, IFNULL((CASE
							   WHEN UW.STOCK_ORDER_YN = 'Y' AND IG.GOODS_TP = 'GOODS_TYPE.DISPOSAL' THEN IIS.D0_STOCK_DISCARD_QTY
							   WHEN UW.STOCK_ORDER_YN = 'Y' THEN IIS.D11_ORDER_QTY
							   WHEN UW.STOCK_ORDER_YN = 'N' AND IIW.UNLIMIT_STOCK_YN = 'Y' THEN 9999
							   ELSE IIW.NOT_IF_STOCK_CNT END
							  ), 0) AS D11_ORDER_QTY
					, IFNULL((CASE
							   WHEN UW.STOCK_ORDER_YN = 'Y' AND IG.GOODS_TP = 'GOODS_TYPE.DISPOSAL' THEN IIS.D0_STOCK_DISCARD_QTY
							   WHEN UW.STOCK_ORDER_YN = 'Y' THEN IIS.D12_ORDER_QTY
							   WHEN UW.STOCK_ORDER_YN = 'N' AND IIW.UNLIMIT_STOCK_YN = 'Y' THEN 9999
							   ELSE IIW.NOT_IF_STOCK_CNT END
							  ), 0) AS D12_ORDER_QTY
					, IFNULL((CASE
							   WHEN UW.STOCK_ORDER_YN = 'Y' AND IG.GOODS_TP = 'GOODS_TYPE.DISPOSAL' THEN IIS.D0_STOCK_DISCARD_QTY
							   WHEN UW.STOCK_ORDER_YN = 'Y' THEN IIS.D13_ORDER_QTY
							   WHEN UW.STOCK_ORDER_YN = 'N' AND IIW.UNLIMIT_STOCK_YN = 'Y' THEN 9999
							   ELSE IIW.NOT_IF_STOCK_CNT END
							  ), 0) AS D13_ORDER_QTY
					, IFNULL((CASE
							   WHEN UW.STOCK_ORDER_YN = 'Y' AND IG.GOODS_TP = 'GOODS_TYPE.DISPOSAL' THEN IIS.D0_STOCK_DISCARD_QTY
							   WHEN UW.STOCK_ORDER_YN = 'Y' THEN IIS.D14_ORDER_QTY
							   WHEN UW.STOCK_ORDER_YN = 'N' AND IIW.UNLIMIT_STOCK_YN = 'Y' THEN 9999
							   ELSE IIW.NOT_IF_STOCK_CNT END
							  ), 0) AS D14_ORDER_QTY
					, IFNULL((CASE
							   WHEN UW.STOCK_ORDER_YN = 'Y' AND IG.GOODS_TP = 'GOODS_TYPE.DISPOSAL' THEN IIS.D0_STOCK_DISCARD_QTY
							   WHEN UW.STOCK_ORDER_YN = 'Y' THEN IIS.D15_ORDER_QTY
							   WHEN UW.STOCK_ORDER_YN = 'N' AND IIW.UNLIMIT_STOCK_YN = 'Y' THEN 9999
							   ELSE IIW.NOT_IF_STOCK_CNT END
							  ), 0) AS D15_ORDER_QTY
					 , UW.WAREHOUSE_NM AS WAREHOUSE_NM
					 , IG.IL_GOODS_ID AS IL_GOODS_ID
					 , IG.GOODS_NM AS GOODS_NM
					 , IFNULL(IG.GOODS_QTY, 1) AS GOODS_QTY
				FROM
					(
						SELECT
							IGPGM.IL_GOODS_ID AS IL_GOODS_ID
							, OIG.GOODS_NM AS GOODS_NM
							, IG.IL_ITEM_CD AS IL_ITEM_CD
							, IG.UR_WAREHOUSE_ID AS UR_WAREHOUSE_ID
							, SUM(IGPGM.GOODS_QTY) AS GOODS_QTY
							, IG.GOODS_TP AS GOODS_TP
							, CASE
							   WHEN IG.GOODS_TP = 'GOODS_TYPE.DISPOSAL' THEN 0
							   ELSE 1
							END AS SORT
						FROM
							IL_GOODS_PACKAGE_GOODS_MAPPING IGPGM
								INNER JOIN IL_GOODS OIG
										   ON OIG.IL_GOODS_ID = IGPGM.IL_GOODS_ID
								INNER JOIN IL_GOODS IG
										   ON IG.IL_GOODS_ID = IGPGM.TARGET_GOODS_ID
						WHERE
							IGPGM.IL_GOODS_ID = #{goodsId}
						GROUP BY IG.IL_ITEM_CD, IG.UR_WAREHOUSE_ID, SORT
					) IG
						INNER JOIN IL_ITEM II
								   ON II.IL_ITEM_CD = IG.IL_ITEM_CD
						INNER JOIN UR_SUPPLIER_WAREHOUSE USW
								   ON USW.UR_SUPPLIER_ID = II.UR_SUPPLIER_ID
									   AND USW.UR_WAREHOUSE_ID = IG.UR_WAREHOUSE_ID
						INNER JOIN UR_WAREHOUSE UW
								   ON UW.UR_WAREHOUSE_ID = USW.UR_WAREHOUSE_ID
						INNER JOIN IL_ITEM_WAREHOUSE IIW
								   ON IIW.IL_ITEM_CD = II.IL_ITEM_CD
									   AND IIW.UR_SUPPLIER_WAREHOUSE_ID = USW.UR_SUPPLIER_WAREHOUSE_ID
						LEFT JOIN IL_ITEM_STOCK IIS
								  ON IIS.IL_ITEM_WAREHOUSE_ID = IIW.IL_ITEM_WAREHOUSE_ID
									  AND IIS.BASE_DT = CURDATE()
			) T
	</select>

	<select id="getOrderQtyList" parameterType="java.util.Map"  resultType="kr.co.pulmuone.v1.goods.stock.dto.vo.StockListResultVo">
		/* stockList.getOrderQtyList */
		SELECT
			 SUM(T.ORDER_D0) AS D0_QUANTITY
			 , SUM(T.ORDER_D1) AS D1_QUANTITY
			 , SUM(T.ORDER_D2) AS D2_QUANTITY
			 , SUM(T.ORDER_D3) AS D3_QUANTITY
			 , SUM(T.ORDER_D4) AS D4_QUANTITY
			 , SUM(T.ORDER_D5) AS D5_QUANTITY
			 , SUM(T.ORDER_D6) AS D6_QUANTITY
			 , SUM(T.ORDER_D7) AS D7_QUANTITY
			 , SUM(T.ORDER_D8) AS D8_QUANTITY
			 , SUM(T.ORDER_D9) AS D9_QUANTITY
			 , SUM(T.ORDER_D10) AS D10_QUANTITY
			 , SUM(T.ORDER_D11) AS D11_QUANTITY
			 , SUM(T.ORDER_D12) AS D12_QUANTITY
			 , SUM(T.ORDER_D13) AS D13_QUANTITY
			 , SUM(T.ORDER_D14) AS D14_QUANTITY
			 , SUM(T.ORDER_D15) AS D15_QUANTITY
		FROM (
				 SELECT
					 OODP.IL_GOODS_ID
					  , IF(DATEDIFF(OOD.SHIPPING_DT, CURDATE()) = 0, OODP.ORDER_CNT, 0) AS ORDER_D0
					  , IF(DATEDIFF(OOD.SHIPPING_DT, CURDATE()) = 1, OODP.ORDER_CNT, 0) AS ORDER_D1
					  , IF(DATEDIFF(OOD.SHIPPING_DT, CURDATE()) = 2, OODP.ORDER_CNT, 0) AS ORDER_D2
					  , IF(DATEDIFF(OOD.SHIPPING_DT, CURDATE()) = 3, OODP.ORDER_CNT, 0) AS ORDER_D3
					  , IF(DATEDIFF(OOD.SHIPPING_DT, CURDATE()) = 4, OODP.ORDER_CNT, 0) AS ORDER_D4
					  , IF(DATEDIFF(OOD.SHIPPING_DT, CURDATE()) = 5, OODP.ORDER_CNT, 0) AS ORDER_D5
					  , IF(DATEDIFF(OOD.SHIPPING_DT, CURDATE()) = 6, OODP.ORDER_CNT, 0) AS ORDER_D6
					  , IF(DATEDIFF(OOD.SHIPPING_DT, CURDATE()) = 7, OODP.ORDER_CNT, 0) AS ORDER_D7
					  , IF(DATEDIFF(OOD.SHIPPING_DT, CURDATE()) = 8, OODP.ORDER_CNT, 0) AS ORDER_D8
					  , IF(DATEDIFF(OOD.SHIPPING_DT, CURDATE()) = 9, OODP.ORDER_CNT, 0) AS ORDER_D9
					  , IF(DATEDIFF(OOD.SHIPPING_DT, CURDATE()) = 10, OODP.ORDER_CNT, 0) AS ORDER_D10
					  , IF(DATEDIFF(OOD.SHIPPING_DT, CURDATE()) = 11, OODP.ORDER_CNT, 0) AS ORDER_D11
					  , IF(DATEDIFF(OOD.SHIPPING_DT, CURDATE()) = 12, OODP.ORDER_CNT, 0) AS ORDER_D12
					  , IF(DATEDIFF(OOD.SHIPPING_DT, CURDATE()) = 13, OODP.ORDER_CNT, 0) AS ORDER_D13
					  , IF(DATEDIFF(OOD.SHIPPING_DT, CURDATE()) = 14, OODP.ORDER_CNT, 0) AS ORDER_D14
					  , IF(DATEDIFF(OOD.SHIPPING_DT, CURDATE()) = 15, OODP.ORDER_CNT, 0) AS ORDER_D15
				 FROM
					 OD_ORDER_DETL_PACK OODP
						 INNER JOIN OD_ORDER OO
									ON OO.OD_ORDER_ID = OODP.OD_ORDER_ID
										AND OO.ORDER_YN = 'Y'
						 INNER JOIN OD_ORDER_DETL OOD
									ON OOD.OD_ORDER_DETL_PARENT_ID = OODP.OD_ORDER_DETL_ID
										AND OOD.SHIPPING_DT BETWEEN CURDATE() AND DATE_ADD(CURDATE(), INTERVAL 15 DAY)
					 WHERE
					 	OODP.IL_GOODS_ID = #{ilGoodsId}
				 GROUP BY OODP.OD_ORDER_DETL_ID
			 ) T
		GROUP BY T.IL_GOODS_ID
		;
	</select>
</mapper>