<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.pulmuone.v1.comm.mapper.goods.stock.ItemStockMapper">

  <resultMap type="kr.co.pulmuone.v1.goods.stock.dto.vo.ItemStockVo" id="itemStockMap">
    <result column="IL_ITEM_STOCK_ID" property="ilItemStockId" />
    <result column="IL_ITEM_WAREHOUSE_ID" property="ilItemWarehouseId" />
    <result column="BASE_DATE"  property="baseDate" />
    <result column="D0_STOCK_QUANTITY" property="d0stockQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D1_STOCK_QUANTITY" property="d1stockQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D2_STOCK_QUANTITY" property="d2stockQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D3_STOCK_QUANTITY" property="d3stockQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D4_STOCK_QUANTITY" property="d4stockQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D5_STOCK_QUANTITY" property="d5stockQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D6_STOCK_QUANTITY" property="d6stockQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D7_STOCK_QUANTITY" property="d7stockQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D8_STOCK_QUANTITY" property="d8stockQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D9_STOCK_QUANTITY" property="d9stockQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D10_STOCK_QUANTITY" property="d10stockQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D0_ORDER_QUANTITY" property="d0orderQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D1_ORDER_QUANTITY" property="d1orderQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D2_ORDER_QUANTITY" property="d2orderQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D3_ORDER_QUANTITY" property="d3orderQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D4_ORDER_QUANTITY" property="d4orderQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D5_ORDER_QUANTITY" property="d5orderQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D6_ORDER_QUANTITY" property="d6orderQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D7_ORDER_QUANTITY" property="d7orderQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D8_ORDER_QUANTITY" property="d8orderQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D9_ORDER_QUANTITY" property="d9orderQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="D10_ORDER_QUANTITY" property="d10orderQuantity" javaType="long" jdbcType="INTEGER" />
    <result column="CREATE_ID" property="createId" />
    <result column="CREATE_DATE" property="createDate" />
    <result column="MODIFY_ID" property="modifyId" />
    <result column="MODIFY_DATE" property="modifyDate" />
    <result column="IL_ITEM_CODE" property="ilItemCode" />
    <result column="UR_SUPPLIER_WAREHOUSE_ID" property="urSupplierWarehouseId" />
    <result column="UNLIMIT_STOCK_YN" property="unlimitStockYn" typeHandler="kr.co.pulmuone.v1.comm.base.mybatis.hanlder.BooleanTypeHandler" />
    <result column="STOCK_PO_YN" property="stockPoYn" typeHandler="kr.co.pulmuone.v1.comm.base.mybatis.hanlder.BooleanTypeHandler" />
    <result column="PRE_ORDER_YN" property="preOrderYn" typeHandler="kr.co.pulmuone.v1.comm.base.mybatis.hanlder.BooleanTypeHandler" />
    <result column="PRE_ORDER_TYPE" property="preOrderType" />
    <result column="MEMO" property="memo" />

  </resultMap>

  <!--───────────────────────────────────────────────────────────────────────
   * description : 출고처별 품목 재고 조회
   * @
   * @ 수정일       수정자   수정내용
   * @ ──────────────────────────────────────────────────────────────────────
   * @ 2020.10.12   박주형   최초생성
   * @
  ────────────────────────────────────────────────────────────────────────-->
  <select id="getItemStock" resultMap="itemStockMap">
    /* itemStock.getItemStock */
    SELECT
        A.IL_ITEM_STOCK_ID                  AS  IL_ITEM_STOCK_ID
      , A.IL_ITEM_WAREHOUSE_ID              AS  IL_ITEM_WAREHOUSE_ID
      , DATE_FORMAT( A.BASE_DT, '%Y%m%d' )  AS  BASE_DATE
      , A.D0_STOCK_QTY                      AS  D0_STOCK_QUANTITY
      , A.D1_STOCK_QTY                      AS  D1_STOCK_QUANTITY
      , A.D2_STOCK_QTY                      AS  D2_STOCK_QUANTITY
      , A.D3_STOCK_QTY                      AS  D3_STOCK_QUANTITY
      , A.D4_STOCK_QTY                      AS  D4_STOCK_QUANTITY
      , A.D5_STOCK_QTY                      AS  D5_STOCK_QUANTITY
      , A.D6_STOCK_QTY                      AS  D6_STOCK_QUANTITY
      , A.D7_STOCK_QTY                      AS  D7_STOCK_QUANTITY
      , A.D8_STOCK_QTY                      AS  D8_STOCK_QUANTITY
      , A.D9_STOCK_QTY                      AS  D9_STOCK_QUANTITY
      , A.D10_STOCK_QTY                     AS  D10_STOCK_QUANTITY
      , A.D0_ORDER_QTY                      AS  D0_ORDER_QUANTITY
      , A.D1_ORDER_QTY                      AS  D1_ORDER_QUANTITY
      , A.D2_ORDER_QTY                      AS  D2_ORDER_QUANTITY
      , A.D3_ORDER_QTY                      AS  D3_ORDER_QUANTITY
      , A.D4_ORDER_QTY                      AS  D4_ORDER_QUANTITY
      , A.D5_ORDER_QTY                      AS  D5_ORDER_QUANTITY
      , A.D6_ORDER_QTY                      AS  D6_ORDER_QUANTITY
      , A.D7_ORDER_QTY                      AS  D7_ORDER_QUANTITY
      , A.D8_ORDER_QTY                      AS  D8_ORDER_QUANTITY
      , A.D9_ORDER_QTY                      AS  D9_ORDER_QUANTITY
      , A.D10_ORDER_QTY                     AS  D10_ORDER_QUANTITY
      , A.CREATE_ID                         AS  CREATE_ID
      , A.CREATE_DT                         AS  CREATE_DATE
      , A.MODIFY_ID                         AS  MODIFY_ID
      , A.MODIFY_DT                         AS  MODIFY_DATE
      , B.IL_ITEM_CD                        AS  IL_ITEM_CODE
      , B.UR_SUPPLIER_WAREHOUSE_ID          AS  UR_SUPPLIER_WAREHOUSE_ID
      , B.UNLIMIT_STOCK_YN                  AS  UNLIMIT_STOCK_YN
      , B.STOCK_PO_YN                       AS  STOCK_PO_YN
      , B.PRE_ORDER_YN                      AS  PRE_ORDER_YN
      , B.PRE_ORDER_TP                      AS  PRE_ORDER_TYPE
      , B.MEMO                              AS  MEMO
      FROM  IL_ITEM_STOCK      A
INNER JOIN  IL_ITEM_WAREHOUSE  B
        ON  A.IL_ITEM_WAREHOUSE_ID = B.IL_ITEM_WAREHOUSE_ID
    <where>
      <if test="@kr.co.pulmuone.v1.comm.util.StringUtil@isNotEmpty(ilItemWarehouseId)">
        AND A.IL_ITEM_WAREHOUSE_ID = #{ilItemWarehouseId}
      </if>

      <if test="@kr.co.pulmuone.v1.comm.util.StringUtil@isNotEmpty(baseDate)">
        AND A.BASE_DT = STR_TO_DATE( #{baseDate}, '%Y%m%d' )
      </if>

      <if test="@kr.co.pulmuone.v1.comm.util.StringUtil@isNotEmpty(ilItemCode)">
        AND B.IL_ITEM_CD = #{ilItemCode}
      </if>

      <if test="@kr.co.pulmuone.v1.comm.util.StringUtil@isNotEmpty(urSupplierWarehouseId)">
        AND B.UR_SUPPLIER_WAREHOUSE_ID = #{urSupplierWarehouseId}
      </if>

      <if test="@kr.co.pulmuone.v1.comm.util.StringUtil@isNotEmpty(urSupplierWarehouseId)">
        AND B.UNLIMIT_STOCK_YN = #{unlimitStockYn, typeHandler=kr.co.pulmuone.v1.comm.base.mybatis.hanlder.BooleanTypeHandler}
      </if>

      <if test="@kr.co.pulmuone.v1.comm.util.StringUtil@isNotEmpty(urSupplierWarehouseId)">
        AND B.STOCK_PO_YN = #{stockPoYn, typeHandler=kr.co.pulmuone.v1.comm.base.mybatis.hanlder.BooleanTypeHandler}
      </if>

      <if test="@kr.co.pulmuone.v1.comm.util.StringUtil@isNotEmpty(urSupplierWarehouseId)">
        AND B.PRE_ORDER_YN = #{preOrderYn, typeHandler=kr.co.pulmuone.v1.comm.base.mybatis.hanlder.BooleanTypeHandler}
      </if>

      <if test="@kr.co.pulmuone.v1.comm.util.StringUtil@isNotEmpty(urSupplierWarehouseId)">
        AND B.PRE_ORDER_TP = #{preOrderType}
      </if>

    </where>

  </select>

  <!--───────────────────────────────────────────────────────────────────────
   * description : 출고처별 품목 재고 저장
   * @
   * @ 수정일       수정자   수정내용
   * @ ──────────────────────────────────────────────────────────────────────
   * @ 2020.10.12   박주형   최초생성
   * @
  ────────────────────────────────────────────────────────────────────────-->
  <insert id="addItemStock">
    /* itemStock.addItemStock */
    INSERT INTO IL_ITEM_STOCK (
        IL_ITEM_WAREHOUSE_ID
      , BASE_DT
      , D0_STOCK_QTY
      , D1_STOCK_QTY
      , D2_STOCK_QTY
      , D3_STOCK_QTY
      , D4_STOCK_QTY
      , D5_STOCK_QTY
      , D6_STOCK_QTY
      , D7_STOCK_QTY
      , D8_STOCK_QTY
      , D9_STOCK_QTY
      , D10_STOCK_QTY
      , D0_ORDER_QTY
      , D1_ORDER_QTY
      , D2_ORDER_QTY
      , D3_ORDER_QTY
      , D4_ORDER_QTY
      , D5_ORDER_QTY
      , D6_ORDER_QTY
      , D7_ORDER_QTY
      , D8_ORDER_QTY
      , D9_ORDER_QTY
      , D10_ORDER_QTY
      , CREATE_ID
    ) VALUES (
        #{ilItemWarehouseId}
      , STR_TO_DATE( #{baseDate} , '%Y%m%d' )
      , #{d0stockQuantity, javaType=long, jdbcType=INTEGER}
      , #{d1stockQuantity, javaType=long, jdbcType=INTEGER}
      , #{d2stockQuantity, javaType=long, jdbcType=INTEGER}
      , #{d3stockQuantity, javaType=long, jdbcType=INTEGER}
      , #{d4stockQuantity, javaType=long, jdbcType=INTEGER}
      , #{d5stockQuantity, javaType=long, jdbcType=INTEGER}
      , #{d6stockQuantity, javaType=long, jdbcType=INTEGER}
      , #{d7stockQuantity, javaType=long, jdbcType=INTEGER}
      , #{d8stockQuantity, javaType=long, jdbcType=INTEGER}
      , #{d9stockQuantity, javaType=long, jdbcType=INTEGER}
      , #{d10stockQuantity, javaType=long, jdbcType=INTEGER}
      , #{d0orderQuantity, javaType=long, jdbcType=INTEGER}
      , #{d1orderQuantity, javaType=long, jdbcType=INTEGER}
      , #{d2orderQuantity, javaType=long, jdbcType=INTEGER}
      , #{d3orderQuantity, javaType=long, jdbcType=INTEGER}
      , #{d4orderQuantity, javaType=long, jdbcType=INTEGER}
      , #{d5orderQuantity, javaType=long, jdbcType=INTEGER}
      , #{d6orderQuantity, javaType=long, jdbcType=INTEGER}
      , #{d7orderQuantity, javaType=long, jdbcType=INTEGER}
      , #{d8orderQuantity, javaType=long, jdbcType=INTEGER}
      , #{d9orderQuantity, javaType=long, jdbcType=INTEGER}
      , #{d10orderQuantity, javaType=long, jdbcType=INTEGER}
      , #{createId}
    )

  </insert>

  <!--───────────────────────────────────────────────────────────────────────
   * description : 출고처별 해당 기준일자의 품목 재고 수정
   * @
   * @ 수정일       수정자   수정내용
   * @ ──────────────────────────────────────────────────────────────────────
   * @ 2020.10.12   박주형   최초생성
   * @
  ────────────────────────────────────────────────────────────────────────-->
  <update id="modifyItemStock">
    /* itemStock.modifyItemStock */
    UPDATE  IL_ITEM_STOCK
       SET  D0_STOCK_QTY         = #{d0stockQuantity, javaType=long, jdbcType=INTEGER}
          , D1_STOCK_QTY         = #{d1stockQuantity, javaType=long, jdbcType=INTEGER}
          , D2_STOCK_QTY         = #{d2stockQuantity, javaType=long, jdbcType=INTEGER}
          , D3_STOCK_QTY         = #{d3stockQuantity, javaType=long, jdbcType=INTEGER}
          , D4_STOCK_QTY         = #{d4stockQuantity, javaType=long, jdbcType=INTEGER}
          , D5_STOCK_QTY         = #{d5stockQuantity, javaType=long, jdbcType=INTEGER}
          , D6_STOCK_QTY         = #{d6stockQuantity, javaType=long, jdbcType=INTEGER}
          , D7_STOCK_QTY         = #{d7stockQuantity, javaType=long, jdbcType=INTEGER}
          , D8_STOCK_QTY         = #{d8stockQuantity, javaType=long, jdbcType=INTEGER}
          , D9_STOCK_QTY         = #{d9stockQuantity, javaType=long, jdbcType=INTEGER}
          , D10_STOCK_QTY        = #{d10stockQuantity, javaType=long, jdbcType=INTEGER}
          , D0_ORDER_QTY         = #{d0orderQuantity, javaType=long, jdbcType=INTEGER}
          , D1_ORDER_QTY         = #{d1orderQuantity, javaType=long, jdbcType=INTEGER}
          , D2_ORDER_QTY         = #{d2orderQuantity, javaType=long, jdbcType=INTEGER}
          , D3_ORDER_QTY         = #{d3orderQuantity, javaType=long, jdbcType=INTEGER}
          , D4_ORDER_QTY         = #{d4orderQuantity, javaType=long, jdbcType=INTEGER}
          , D5_ORDER_QTY         = #{d5orderQuantity, javaType=long, jdbcType=INTEGER}
          , D6_ORDER_QTY         = #{d6orderQuantity, javaType=long, jdbcType=INTEGER}
          , D7_ORDER_QTY         = #{d7orderQuantity, javaType=long, jdbcType=INTEGER}
          , D8_ORDER_QTY         = #{d8orderQuantity, javaType=long, jdbcType=INTEGER}
          , D9_ORDER_QTY         = #{d9orderQuantity, javaType=long, jdbcType=INTEGER}
          , D10_ORDER_QTY        = #{d10orderQuantity, javaType=long, jdbcType=INTEGER}
          , MODIFY_ID            = #{modifyId}
    <where>
      <choose>
        <when test="@kr.co.pulmuone.v1.comm.util.StringUtil@isNotEmpty(ilItemWarehouseId)" >
            AND  IL_ITEM_WAREHOUSE_ID = #{ilItemWarehouseId}
        </when>
        <when test="@kr.co.pulmuone.v1.comm.util.StringUtil@isNotEmpty(ilItemCode) and @kr.co.pulmuone.v1.comm.util.StringUtil@isNotEmpty(urSupplierWarehouseId)" >
            AND  IL_ITEM_WAREHOUSE_ID = ( SELECT  IL_ITEM_WAREHOUSE_ID
                                            FROM  IL_ITEM_WAREHOUSE
                                           WHERE  IL_ITEM_CD                = #{ilItemCode}
                                             AND  UR_SUPPLIER_WAREHOUSE_ID  = #{urSupplierWarehouseId} )
        </when>
        <otherwise>
            AND  1 = 0   <!-- 필수 param 전달되지 않은 경우 UPDATE 문 수행되지 않도록 처리 -->
        </otherwise>
      </choose>
            AND  BASE_DT         = STR_TO_DATE( #{baseDate} , '%Y%m%d' )
    </where>

  </update>

</mapper>
