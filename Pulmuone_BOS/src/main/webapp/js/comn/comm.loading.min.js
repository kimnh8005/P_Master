var LOADING_TIMER;

/**
 * 로딩 생성 함수 
 */
function fnOpenLoading(messages, loadingTime){
	
	if( !loadingTime ){
		loadingTime = 20;
	}
	
	fnLoadingLayer(messages);
	//$('#loading_layer').fadeIn('fast');
	$('#loading_layer').css('display','block');
	fnLoadingCenter();
	
	// 로딩 타이머 시작.
	//LOADING_TIMER = setInterval(fnLoadingTimeOver, (loadingTime * 1000));		// 1/1000초 단위로 체크하여 정해진시간에 함수 호출.
	setTimeout(function() {
			      fnLoadingTimeOver();
			   }, loadingTime * 1000);	
}


/**
 * 로딩 레이어 생성 함수 
 */
function fnLoadingLayer(){

	if($('#loading_layer').size() == 0){
/*
		var load_top  = $('div #contents').offset().top + 'px';
		var load_left = ( $('div #contents').offset().left + 0 ) + 'px';
		var load_w    = ( $('div #contents').outerWidth() - 0 ) + 'px';
*/		
		var tag  = '<div class="pop_wrap" id="loading_layer" style="display:none;position:fixed;z-index:99999">';
			tag += '	<div class="loading ui-draggable" style="z-index:9999;background:url(/contents/images/loading.gif);width:100px;height:100px;" >';
			tag += '		<p class="info_txt" style="cursor:pointer;line-height:0px;font-weight:bold;color:#d08d0b;text-align:center"></p>';
			tag += '	</div>';
			tag += '	<div class="popup_bg" style="position:fixed;top:0;right:0;left:0;bottom:0;z-index:999;width:100%;height:100%;background:#fff;opacity: 0.5;"></div>'; // #343434
			//tag += '	<div class="popup_bg" style="position:fixed;top:'+load_top+';right:0;left:'+load_left+';bottom:0;z-index:999;width:'+load_w+';height:100%;background:#fff;opacity: 1;"></div>'; // #343434
		    tag += '</div>';		

		$("body").append( tag );
	}
}

/**
 * 로딩 이미지를 중앙으로 위치시키는 함수 
 */
function fnLoadingCenter(){
	$obj = $('#loading_layer .loading.ui-draggable');
	$obj.css({ 'position': 'fixed',
		       'top': $(window).height() / 2 - $obj.height() / 2,
		       'left': $(window).width() / 2 - $obj.width() / 2
	});
}

/**
 * 로딩 타임오버시 닫기버튼 생성
 */
function fnLoadingTimeOver(){
	console.log('call fnLoadingTimeOver');
	// 타이머 해제.
	//console.log('fnLoadingTimeOver');
	//clearInterval(LOADING_TIMER);
	var html = '<a class="btn_inner"><span id="commClose">Close</span> | <span id="commLocation">Reload</span></a>';
	
	$('div.loading > p.info_txt').html( html );
	$('#commClose').on('click', function(){fnCloseLoading();});
	$('#commLocation').on('click', function(){fnCloseReload();});
	
	//$('div.loading > p.info_txt').html($('<a />').addClass('btn_inner').append($('<span />').text('Close')).on('click', function(){fnCloseLoading();}));
	//$('div.loading > p.info_txt').html($('<a />').addClass('btn_inner').append($('<span />').text(' | Reload')).on('click', function(){fnCloseLoading();}));
}

/**
 * 로딩 해제 함수
 */
function fnCloseLoading(){
	//clearInterval(LOADING_TIMER);
	$('#loading_layer').fadeOut('slow');
	//$('#loading_layer').remove();
}

function fnCloseReload(){
	//clearInterval(LOADING_TIMER);
	$('#loading_layer').fadeOut('slow', function(){
		window.location.reload(true);
	});
}
