(function($){
    $.fn.extend({
        /**
         * KendoEditor 초기 호출 함수
         * Option 정보를 가지고 에디터를 초기화 및 설정을 해준다.
         * 이 함수를 호출하면 에디터가 화면에 출력된다.
         *
         * @param options : Kendo UI Editor Option
         */
        initializeKendoEditor: function( options ){
            return this.each(function() {

				var $obj = $(this);

            	if( options == undefined ){
            		options = {};
            	}

            	$.extend(options, {
								id  : $obj.attr('id'),	// tag id
								encoded: true,
							});

            	// Kendo Editor 설정.
            	fnKendoEditor( options );

            });
        }, //--------------------------------------------------- END initializeKendoGrid
        /**
         * cKendoEditor Data 반환
         */
        cKendoEditor: function(){
        	return $(this).data('kendoEditor');
        } //--------------------------------------------------- END cKendoGrid

    });
})(jQuery);


var EDITOR_IMAGE_UPLOAD_CNT = 0;
var UPLOAD_STORAGE_TYPE = "public";

/**
 * fnKendoEditor 생성 및 이벤트 처리
 *
 * @param {Object} opt : kendo 설정 옵션
 *
 * opt.id            : Tag ID
 *
 */
function fnKendoEditor( opt ){

	$('#' + opt.id).kendoEditor({
	    tools: [
	        { name : 'viewHtml'    , tooltip : 'HTML 소스보기' },
	        { name : 'pdf'         , tooltip : 'PDF 저장' },
	        //------------------- 구분선 ----------------------
	        { name : 'bold'         , tooltip : '진하게' },
	        { name : 'italic'       , tooltip : '이탤릭' },
	        { name : 'underline'    , tooltip : '밑줄' },
	        { name : 'strikethrough', tooltip : '취소선' },
	        //------------------- 구분선 ----------------------
	        { name : 'foreColor', tooltip : '글자색상' },
	        { name : 'backColor', tooltip : '배경색상' },
	        //------------------- 구분선 ----------------------
	        { name : 'justifyLeft'  , tooltip : '왼쪽 정렬' },
	        { name : 'justifyCenter', tooltip : '가운데 정렬' },
	        { name : 'justifyRight' , tooltip : '오른쪽 정렬' },
	        { name : 'justifyFull'  , tooltip : '양쪽 맞춤' },
	        //------------------- 구분선 ----------------------
	        { name : 'insertUnorderedList', tooltip : '글머리기호' },
	        { name : 'insertOrderedList'  , tooltip : '번호매기기' },
	        { name : 'indent'             , tooltip : '들여쓰기' },
	        { name : 'outdent'            , tooltip : '내어쓰기' },
	        //------------------- 구분선 ----------------------
	        { name : 'createLink'  , tooltip : '하이퍼링크 연결' },
	        { name : 'unlink'      , tooltip : '하이퍼링크 제거' },
	        //{ name : 'insertImage' , tooltip : '이미지 삽입/속성' },

	        { name : 'file-image'
	        , exec : function(e){

						e.preventDefault();

						console.log( $('#fEditForm').html() );

	        	if( $('#fEditForm').length === 0 ){
	        		var uploadFormTag  = '<form id="fEditForm" class="hidden-form" name="fEditForm" method="post" enctype="multipart/form-data" onsubmit="return false;">';
	        	    	uploadFormTag += '<input type="hidden"	id="BIZ_CLASS" 	name="BIZ_CLASS" value="editor">';
	        	    	uploadFormTag += '<input type="hidden"	id="FOLDER1"   	name="FOLDER1"   value="images">';
	        	    	uploadFormTag += '<input type="file"	id="fEditFile" 	name="fEditFile" onchange="fnImageFileUpload(\'' + opt.fid + '\',\'' + opt.id + '\',\'' + opt.domain + '\')">';
	        	    	uploadFormTag += '<input type="text"	id="EDITER_SEQ"	name="EDITER_SEQ" style="width:200px;"/>';
	        	    	uploadFormTag += '</form>';
	        	    //this.blur();this.focus();
	        		$('.wrap-location').append(uploadFormTag);
	        		console.log('i make fEditForm');
	        	}
	        	/*
	        	if( $('#EDITER_SEQ').val() == undefined ){
	        		$('#' + opt.fid).append('<input type="hidden" id="EDITER_SEQ"   name="EDITER_SEQ" style="width:200px;"/> ');
	        	}else{
	        		$('#fEditForm').append('<input type="hidden" id="EDITER_SEQ"   name="EDITER_SEQ" style="width:200px;" value="' + $('#EDITER_SEQ').val() + '"/> ');
	        	}
	        	*/
	        	if( $('form#' + opt.fid + ' input#EDITER_SEQ').val() != '' ){
	        		//$('#fEditForm').append('<input type="text" id="EDITER_SEQ"   name="EDITER_SEQ" style="width:200px;" value="' + $('#EDITER_SEQ').val() + '"/> ');
	        		$('form#fEditForm input#EDITER_SEQ').val( $('form#' + opt.fid + ' input#EDITER_SEQ').val() );
	        		console.log( 'i check data ' + opt.fid + '.EDITER_SEQ >> ' + $('form#' + opt.fid + ' input#EDITER_SEQ').val() );
	        		console.log( 'i set data fEditForm.EDITER_SEQ >> ' + $('form#fEditForm input#EDITER_SEQ').val() );
	        	}

				$('#fEditFile').trigger('click');

				if(USER_BROWSER.indexOf('ie') > -1){
					$('#fEditFile').attr('onchange', function(){
				        //alert('IE FILE CHANGE EVENT');
				        //$('#fEditFile').trigger('change');
				    });
				}

	        	/*
	        	$('#fEditFile').on('change', function(e){
	        	});
	        	*/
	        }
	        , tooltip : '이미지 삽입/속성' },

	        { name : 'insertFile'  , tooltip : '파일 삽입' },
	        //------------------- 구분선 ----------------------
	        { name : 'subscript'   , tooltip : '아래 첨자' },
	        { name : 'superscript' , tooltip : '위 첨자' },
	        //------------------- 구분선 ----------------------
	        { name : 'tableWizard'    , tooltip : '표 수정' },
	        { name : 'createTable'    , tooltip : '표 만들기' },
	        { name : 'addRowAbove'    , tooltip : '위 행 추가' },
	        { name : 'addRowBelow'    , tooltip : '아래 행 추가' },
	        { name : 'addColumnLeft'  , tooltip : '왼쪽 열 추가' },
	        { name : 'addColumnRight' , tooltip : '오른쪽 열 추가' },
	        { name : 'deleteRow'      , tooltip : '행 삭제' },
	        { name : 'deleteColumn'   , tooltip : '열 삭제' },
	        { name : 'mergeCellsHorizontally'   , tooltip : '수평으로 셀 병합' },
	        { name : 'mergeCellsVertically'   , tooltip : '수직으로 셀 병합' },
	        { name : 'splitCellHorizontally'   , tooltip : '수평으로 셀 분할' },
	        { name : 'splitCellVertically'   , tooltip : '수직으로 셀 분할' },
	        //------------------- 구분선 ----------------------
	        'formatting',
	        'fontName',
	        {
	        	name: 'fontSize',
	            items: [
	                { text: '8px' , value: '8px' },
	                { text: '9px' , value: '9px' },
	                { text: '10px', value: '10px' },
	                { text: '11px', value: '11px' },
	                { text: '12px', value: '12px' },
	                { text: '13px', value: '13px' },
	                { text: '14px', value: '14px' },
	                { text: '16px', value: '16px' },
	                { text: '18px', value: '18px' },
	                { text: '20px', value: '20px' },
	                { text: '22px', value: '22px' },
	                { text: '24px', value: '24px' },
	                { text: '26px', value: '26px' },
	            	{ text: '28px', value: '28px' },
	            	{ text: '36px', value: '36px' },
	            	{ text: '48px', value: '48px' },
	            	{ text: '72px', value: '72px' },
	        	]
	        }
	        //	,'print'
	    ],
	    pdf: {
	      landscape: true,
	      paperSize : 'A4'
	  	},
	    messages: {
		    formatting     : '포맷'  	, formatBlock: '포맷을 선택하세요.',
		    fontNameInherit: '폰트'  	, fontName   : '글자 폰트를 선택하세요.',
		    fontSizeInherit: '글자크기'	, fontSize   : '글자 크기를 선택하세요.',
		    //------------------- 구분선 ----------------------
		    print : '출력',
		    //------------------- 구분선 ----------------------

		    //------------------- 구분선 ----------------------
		    imageWebAddress: '웹 주소',
		    imageAltText   : '대체 문구', //Alternate text
		    //------------------- 구분선 ----------------------
		    fileWebAddress: '웹 주소',
		    fileTitle     : '링크 문구',
		    //------------------- 구분선 ----------------------
		    linkWebAddress: '웹 주소',
		    linkText      : '선택 문구',
		    linkToolTip   : '풍선 도움말',
		    linkOpenInNewWindow: '새 창에서 열기', //Open link in new window
		    //------------------- 구분선 ----------------------
		    dialogInsert: '적용',
		    dialogUpdate: 'Update',
		    dialogCancel: '닫기',
	    	//-----------------------------

		    insertHtml: 'Insert HTML',
		    style: 'Styles',
		    emptyFolder: 'Empty Folder',
		    uploadFile: 'Upload',
		    orderBy: 'Arrange by:',
		    orderBySize: 'Size',
		    orderByName: 'Name',
		    invalidFileType: 'The selected file \'{0}\' is not valid. Supported file types are {1}.',
		    deleteFile: 'Are you sure you want to delete \'{0}\'?',
		    overwriteFile: 'A file with name \'{0}\' already exists in the current directory. Do you want to overwrite it?',
		    directoryNotFound: 'A directory with this name was not found.'
	    }
	});

	$('<br/>').insertAfter( $('.k-i-create-table').closest('li') );


}

/*
function readImage(file) {

    var reader = new FileReader();
    var image  = new Image();

    reader.readAsDataURL(file);
    reader.onload = function(_file) {
        image.src    = _file.target.result;              // url.createObjectURL(file);
        image.onload = function() {
            var w = this.width,
                h = this.height,
                t = file.type,                           // ext only: // file.type.split('/')[1],
                n = file.name,
                s = ~~(file.size/1024) +'KB';
            console.log('<img src="'+ this.src +'"> '+w+'x'+h+' '+s+' '+t+' '+n+'<br>');
        };
        image.onerror= function() {
            console.log('Invalid file type: '+ file.type);
        };
    };
}
*/

/**
 *
 * @param {*} a : fid
 * @param {*} b : editor id
 * @param {*} domain : domain name
 */
function fnImageFileUpload( a, b, domain ){
	try{

		console.log("[fnImageFileUpload] > a : ", a);
		console.log("[fnImageFileUpload] > b : ", b);

		var uploadImageSize = document.querySelector('#fEditForm > input[type=file]').files[0].size;

		console.log("[fnImageFileUpload] > uploadImage : ", document.querySelector('#fEditForm > input[type=file]'));

		if( UPLOAD_IMAGE_SIZE < uploadImageSize ){
			fnKendoMessage({message : fnGetLangData({ key :"6700", nullMsg :'이미지 업로드 허용 최대 용량은 3MB입니다..' }) ,ok : function(e){}});
			$('#fEditForm').remove();
			return;
		}

	} catch(e) {
		console.error(e);
		$('#fEditForm').remove();
	}

	//readImage( document.querySelector('#fEditForm > input[type=file]').files[0] );

	var opt = {
		 fid : a
		,id  : b
	};

	/**
	 * todo : 에디터기에서 파일첨부 클릭 후 취소를 반복한 다음 파일 업로드를 할 경우 문제 발생
	 * 추후 개선 필요.
	 */
	console.log( 'set EDITOR_IMAGE_UPLOAD_CNT : ' + EDITOR_IMAGE_UPLOAD_CNT );

	if( $('#fEditFile').val() != '' && EDITOR_IMAGE_UPLOAD_CNT == 0 ){

		EDITOR_IMAGE_UPLOAD_CNT++;

		var _data = {
			'storageType' : UPLOAD_STORAGE_TYPE,
			'domain' : domain ? domain : "",
		}

		$('#fEditForm').ajaxSubmit({
			 dataType: 'json'
			,cache   : false
			,data : _data
			,url     : '/comn/fileUpload'
			,contentType: 'application/x-www-form-urlencoded; charset=UTF-8'
			,success : function(data){

				data = data.data;

				var imageUrl = data.publicStorageUrl + data.addFile[0].serverSubPath + data.addFile[0].physicalFileName;

			    //$('#EDITER_SEQ').val(  );
			    //$('form#fEditForm input#EDITER_SEQ').val();
			    $('form#' + opt.fid + ' input#EDITER_SEQ').val( data.addFile[0].editerSeq );
			    console.log( 'i set data ' + opt.fid + '.EDITER_SEQ >> ' + data.addFile[0].editerSeq );

				var editor = $('#' + opt.id).data("kendoEditor");
					// editor.exec('inserthtml', { value: '<img src="/comn/getView?FILE_NAME=' + data.addFile[0].physicalName + '&SUB_PATH=' + data.addFile[0].serverSubPath + '"/>' });
				editor.exec('inserthtml', { value: '<img src=' + imageUrl + '/>' });
				$('#fEditForm').remove();
				console.log('i remove fEditForm');

				EDITOR_IMAGE_UPLOAD_CNT--;

				console.log( 'EDITOR_IMAGE_UPLOAD_CNT : ' + EDITOR_IMAGE_UPLOAD_CNT );
			}
		});
	}else{
		$('#fEditForm').remove();
	}
}


/**
 * fnKendoEditorTp1 생성 및 이벤트 처리
 *
 * @param {Object} opt : kendo 설정 옵션
 *
 * opt.id            : Tag ID
 *
 */
function fnKendoEditorTp1( opt ){

	$('#' + opt.id).kendoEditor({
	    tools: [


	        //------------------- 구분선 ----------------------
	        'fontName',
	        {
	        	name: 'fontSize',
	            items: [
	                { text: '8px' , value: '8px' },
	                { text: '9px' , value: '9px' },
	                { text: '10px', value: '10px' },
	                { text: '11px', value: '11px' },
	                { text: '12px', value: '12px' },
	                { text: '13px', value: '13px' },
	                { text: '14px', value: '14px' },
	                { text: '16px', value: '16px' },
	                { text: '18px', value: '18px' },
	                { text: '20px', value: '20px' },
	                { text: '22px', value: '22px' },
	                { text: '24px', value: '24px' },
	                { text: '26px', value: '26px' },
	            	{ text: '28px', value: '28px' },
	            	{ text: '36px', value: '36px' },
	            	{ text: '48px', value: '48px' },
	            	{ text: '72px', value: '72px' },
	        	]
	        },
			//------------------- 구분선 ----------------------
	        { name : 'bold'         , tooltip : '진하게' },
	        { name : 'italic'       , tooltip : '이탤릭' },
	        { name : 'underline'    , tooltip : '밑줄' },
	        { name : 'strikethrough', tooltip : '취소선' },
	        //------------------- 구분선 ----------------------
	        { name : 'foreColor', tooltip : '글자색상' },
	        { name : 'backColor', tooltip : '배경색상' },
	        //------------------- 구분선 ----------------------
	        { name : 'justifyLeft'  , tooltip : '왼쪽 정렬' },
	        { name : 'justifyCenter', tooltip : '가운데 정렬' },
	        { name : 'justifyRight' , tooltip : '오른쪽 정렬' },
	        { name : 'justifyFull'  , tooltip : '양쪽 맞춤' },
	        //------------------- 구분선 ----------------------
	        { name : 'insertUnorderedList', tooltip : '글머리기호' },
	        { name : 'insertOrderedList'  , tooltip : '번호매기기' },
	        { name : 'indent'             , tooltip : '들여쓰기' },
	        { name : 'outdent'            , tooltip : '내어쓰기' },
	        //------------------- 구분선 ----------------------
	        { name : 'createLink'  , tooltip : '하이퍼링크 연결' },
	        { name : 'unlink'      , tooltip : '하이퍼링크 제거' },
	        //------------------- 구분선 ----------------------
	        { name : 'tableWizard'    , tooltip : '표 수정' },
	        { name : 'createTable'    , tooltip : '표 만들기' },
	        { name : 'addRowAbove'    , tooltip : '위 행 추가' },
	        { name : 'addRowBelow'    , tooltip : '아래 행 추가' },
	        { name : 'addColumnLeft'  , tooltip : '왼쪽 열 추가' },
	        { name : 'addColumnRight' , tooltip : '오른쪽 열 추가' },
	        { name : 'deleteRow'      , tooltip : '행 삭제' },
	        { name : 'deleteColumn'   , tooltip : '열 삭제' },
	        { name : 'mergeCellsHorizontally'   , tooltip : '수평으로 셀 병합' },
	        { name : 'mergeCellsVertically'   , tooltip : '수직으로 셀 병합' },
	        { name : 'splitCellHorizontally'   , tooltip : '수평으로 셀 분할' },
	        { name : 'splitCellVertically'   , tooltip : '수직으로 셀 분할' },
	    ],
	    messages: {
		    formatting     : '포맷'  	, formatBlock: '포맷을 선택하세요.',
		    fontNameInherit: '폰트'  	, fontName   : '글자 폰트를 선택하세요.',
		    fontSizeInherit: '글자크기'	, fontSize   : '글자 크기를 선택하세요.',
		    //------------------- 구분선 ----------------------
		    imageWebAddress: '웹 주소',
		    imageAltText   : '대체 문구', //Alternate text
		    //------------------- 구분선 ----------------------
		    fileWebAddress: '웹 주소',
		    fileTitle     : '링크 문구',
		    //------------------- 구분선 ----------------------
		    linkWebAddress: '웹 주소',
		    linkText      : '선택 문구',
		    linkToolTip   : '풍선 도움말',
		    linkOpenInNewWindow: '새 창에서 열기', //Open link in new window
		    //------------------- 구분선 ----------------------
		    dialogInsert: '적용',
		    dialogUpdate: 'Update',
		    dialogCancel: '닫기',
	    	//-----------------------------

		    insertHtml: 'Insert HTML',
		    style: 'Styles',
		    emptyFolder: 'Empty Folder',
		    uploadFile: 'Upload',
		    orderBy: 'Arrange by:',
		    orderBySize: 'Size',
		    orderByName: 'Name',
		    invalidFileType: 'The selected file \'{0}\' is not valid. Supported file types are {1}.',
		    deleteFile: 'Are you sure you want to delete \'{0}\'?',
		    overwriteFile: 'A file with name \'{0}\' already exists in the current directory. Do you want to overwrite it?',
		    directoryNotFound: 'A directory with this name was not found.'
	    }
	});

	$('<br/>').insertAfter( $('.k-i-create-table').closest('li') );


}


/**
 * fnKendoEditor 생성 및 이벤트 처리
 *
 * @param {Object} opt : kendo 설정 옵션
 *
 * opt.id            : Tag ID
 *
 */
function fnKendoEditorTp2( opt ){

	$('#' + opt.id).kendoEditor({
	    tools: [
	        { name : 'viewHtml'    , tooltip : 'HTML 소스보기' },
	        { name : 'pdf'         , tooltip : 'PDF 저장' },
	        //------------------- 구분선 ----------------------
	        { name : 'bold'         , tooltip : '진하게' },
	        { name : 'italic'       , tooltip : '이탤릭' },
	        { name : 'underline'    , tooltip : '밑줄' },
	        { name : 'strikethrough', tooltip : '취소선' },
	        //------------------- 구분선 ----------------------
	        { name : 'foreColor', tooltip : '글자색상' },
	        { name : 'backColor', tooltip : '배경색상' },
	        //------------------- 구분선 ----------------------
	        { name : 'justifyLeft'  , tooltip : '왼쪽 정렬' },
	        { name : 'justifyCenter', tooltip : '가운데 정렬' },
	        { name : 'justifyRight' , tooltip : '오른쪽 정렬' },
	        { name : 'justifyFull'  , tooltip : '양쪽 맞춤' },
	        //------------------- 구분선 ----------------------
	        { name : 'insertUnorderedList', tooltip : '글머리기호' },
	        { name : 'insertOrderedList'  , tooltip : '번호매기기' },
	        { name : 'indent'             , tooltip : '들여쓰기' },
	        { name : 'outdent'            , tooltip : '내어쓰기' },
	        //------------------- 구분선 ----------------------
	        { name : 'createLink'  , tooltip : '하이퍼링크 연결' },
	        { name : 'unlink'      , tooltip : '하이퍼링크 제거' },
	        { name : 'insertImage' , tooltip : '이미지 삽입/속성' },
	        { name : 'insertFile'  , tooltip : '파일 삽입' },
	        //------------------- 구분선 ----------------------
	        { name : 'subscript'   , tooltip : '아래 첨자' },
	        { name : 'superscript' , tooltip : '위 첨자' },
	        //------------------- 구분선 ----------------------
	        { name : 'tableWizard'    , tooltip : '표 수정' },
	        { name : 'createTable'    , tooltip : '표 만들기' },
	        { name : 'addRowAbove'    , tooltip : '위 행 추가' },
	        { name : 'addRowBelow'    , tooltip : '아래 행 추가' },
	        { name : 'addColumnLeft'  , tooltip : '왼쪽 열 추가' },
	        { name : 'addColumnRight' , tooltip : '오른쪽 열 추가' },
	        { name : 'deleteRow'      , tooltip : '행 삭제' },
	        { name : 'deleteColumn'   , tooltip : '열 삭제' },
	        { name : 'mergeCellsHorizontally'   , tooltip : '수평으로 셀 병합' },
	        { name : 'mergeCellsVertically'   , tooltip : '수직으로 셀 병합' },
	        { name : 'splitCellHorizontally'   , tooltip : '수평으로 셀 분할' },
	        { name : 'splitCellVertically'   , tooltip : '수직으로 셀 분할' },
	        //------------------- 구분선 ----------------------
	        'formatting',
	        'fontName',
	        {
	        	name: 'fontSize',
	            items: [
	                { text: '8px' , value: '8px' },
	                { text: '9px' , value: '9px' },
	                { text: '10px', value: '10px' },
	                { text: '11px', value: '11px' },
	                { text: '12px', value: '12px' },
	                { text: '13px', value: '13px' },
	                { text: '14px', value: '14px' },
	                { text: '16px', value: '16px' },
	                { text: '18px', value: '18px' },
	                { text: '20px', value: '20px' },
	                { text: '22px', value: '22px' },
	                { text: '24px', value: '24px' },
	                { text: '26px', value: '26px' },
	            	{ text: '28px', value: '28px' },
	            	{ text: '36px', value: '36px' },
	            	{ text: '48px', value: '48px' },
	            	{ text: '72px', value: '72px' },
	        	]
	        }
	        //	,'print'
	    ],
	    pdf: {
	      landscape: true,
	      paperSize : 'A4'
	  	},
	    messages: {
		    formatting     : '포맷'  	, formatBlock: '포맷을 선택하세요.',
		    fontNameInherit: '폰트'  	, fontName   : '글자 폰트를 선택하세요.',
		    fontSizeInherit: '글자크기'	, fontSize   : '글자 크기를 선택하세요.',
		    //------------------- 구분선 ----------------------
		    print : '출력',
		    //------------------- 구분선 ----------------------

		    //------------------- 구분선 ----------------------
		    imageWebAddress: '웹 주소',
		    imageAltText   : '대체 문구', //Alternate text
		    //------------------- 구분선 ----------------------
		    fileWebAddress: '웹 주소',
		    fileTitle     : '링크 문구',
		    //------------------- 구분선 ----------------------
		    linkWebAddress: '웹 주소',
		    linkText      : '선택 문구',
		    linkToolTip   : '풍선 도움말',
		    linkOpenInNewWindow: '새 창에서 열기', //Open link in new window
		    //------------------- 구분선 ----------------------
		    dialogInsert: '적용',
		    dialogUpdate: 'Update',
		    dialogCancel: '닫기',
	    	//-----------------------------

		    insertHtml: 'Insert HTML',
		    style: 'Styles',
		    emptyFolder: 'Empty Folder',
		    uploadFile: 'Upload',
		    orderBy: 'Arrange by:',
		    orderBySize: 'Size',
		    orderByName: 'Name',
		    invalidFileType: 'The selected file \'{0}\' is not valid. Supported file types are {1}.',
		    deleteFile: 'Are you sure you want to delete \'{0}\'?',
		    overwriteFile: 'A file with name \'{0}\' already exists in the current directory. Do you want to overwrite it?',
		    directoryNotFound: 'A directory with this name was not found.'
	    }
	});

	$('<br/>').insertAfter( $('.k-i-create-table').closest('li') );


}
